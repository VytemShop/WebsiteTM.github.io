
!function(e){"use strict";function t(e,t,i,s){return new(i||(i=Promise))((function(n,o){function r(e){try{a(s.next(e))}catch(e){o(e)}}function d(e){try{a(s.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,d)}a((s=s.apply(e,t||[])).next())}))}class i{constructor(e,t,s){this.remoteUrl=i.DEFAULT_REMOTE_ADS_CONFIG_URL,this.platformId=e,this.channelId=t,this.logger=s}setBaseUrl(e){this.remoteUrl=e}get(e){var i;return t(this,void 0,void 0,(function*(){if(!(e&&this.platformId&&this.channelId))throw new Error("gameId, platformId and channelId are required to retrieve remote ads config");null===(i=this.logger)||void 0===i||i.debug("[FRVR-SDK] fetching remote ads config");const t=yield fetch(this.getRemoteConfigUrl(e));if(!t.ok)throw new Error(t.statusText);return yield t.json()}))}getRemoteConfigUrl(e){return this.remoteUrl.replace("{GAME}",e).replace("{PLATFORM}",this.platformId).replace("{CHANNEL}",this.channelId)}}i.DEFAULT_REMOTE_ADS_CONFIG_URL="https://fran-cdn.frvr.com/configs/ads/{GAME}/{PLATFORM}/{CHANNEL}/sdk.json";class s{constructor(){this._promise=new Promise(((e,t)=>{this._resolve=e,this._reject=t}))}get promise(){return this._promise}resolve(e){this._resolve(e)}reject(e){this._reject(e)}}class n{static isFrame(){return window.self!==window.top}static getBrowserWidth(){var e;let t;const i=n.isFrame()?window:window.top||window,s=i.outerWidth||9999;return t=void 0!==i.innerWidth?i.innerWidth:void 0!==i.document.documentElement&&void 0!==i.document.documentElement.clientWidth&&0!==i.document.documentElement.clientWidth?i.document.documentElement.clientWidth:null===(e=i.document.body)||void 0===e?void 0:e.clientWidth,Math.min(t,s)}static getBrowserHeight(){var e;let t;const i=n.isFrame()?window:window.top||window,s=i.outerHeight||9999;return t=void 0!==i.innerHeight?i.innerHeight:void 0!==i.document.documentElement&&void 0!==i.document.documentElement.clientHeight&&0!==i.document.documentElement.clientHeight?i.document.documentElement.clientHeight:null===(e=i.document.body)||void 0===e?void 0:e.clientHeight,Math.min(t,s)}static isInterstitial(e){return e.ortb2Imp&&e.ortb2Imp.instl&&1===e.ortb2Imp.instl}static filterAdUnitSizes(e,t,i,s){const o=t.mediaTypes||{},r=n.isInterstitial(t);i=i||n.getBrowserWidth(),s=s||n.getBrowserHeight(),o.banner&&(Array.isArray(o.banner.sizes)&&o.banner.sizes.length>0||(o.banner.sizes=e.banner),r&&(i*=.9,s*=.9),o.banner.sizes=n.filterSizesArray(o.banner.sizes,i,s)),o.video&&(o.video.playerSize&&Array.isArray(o.video.playerSize)&&o.video.playerSize.length>0||(o.video.playerSize=n.filterSizesArray(e.video,i,s)[0]))}static generateUUID(){if(window.crypto&&window.crypto.randomUUID)return window.crypto.randomUUID();let e=(new Date).getTime(),t="undefined"!=typeof performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(i){let s=16*Math.random();return e>0?(s=(e+s)%16|0,e=Math.floor(e/16)):(s=(t+s)%16|0,t=Math.floor(t/16)),("x"===i?s:3&s|8).toString(16)}))}static loadScript(e){if(e){const t=document.createElement("script");return t.type="text/javascript",t.async=!0,t.src=e,document.head.appendChild(t)}}static overridePollfishContainerZIndex(e){const t=document.getElementById("pollfishSurveyContainer");t&&(t.style["z-index"]=e)}static loadGPT(e){if(!n.gptLoaded){if(window.googletag&&window.googletag.apiReady)return;let t=n.DEFAULT_GPT_URL;e&&e.url&&(t=e.url),n.loadScript(t),n.gptLoaded=!0}}static loadPubX(e){(null==e?void 0:e.enabled)&&(null==e?void 0:e.tagURI)&&!n.pubxLoaded&&(n.loadScript(null==e?void 0:e.tagURI),n.pubxLoaded=!0)}static loadPrebid(e){if(!n.prebidLoaded){let t=n.DEFAULT_PREBID_URL;e&&e.url&&(t=e.url),n.loadScript(t),n.prebidLoaded=!0}}static loadPollfish(e){if(!n.pollfishLoaded){let t=n.DEFAULT_JQUERY_URL,i=n.DEFAULT_POLLFISH_SDK_URL;e&&(e.jqueryUrl&&(t=e.jqueryUrl),e.pollfishSdkUrl&&(i=e.pollfishSdkUrl)),n.loadScript(t).onload=function(){n.loadScript(i)},window.pollfishConfig=Object.assign(Object.assign({},window.pollfishConfig||{}),{api_key:e.apiKey,debug:!!e.debug}),n.pollfishLoaded=!0}}static loadIMA(e){if(!n.imaLoaded){let t=n.DEFAULT_IMA_URL;e&&e.url&&(t=e.url);const i=n.loadScript(t);i.onerror=e=>{n.imaReady.reject(e)},i.onload=()=>{n.imaReady.resolve()},n.imaLoaded=!0}}static loadApsTag(e){!n.apsTagLoaded&&e&&e.pubID&&(!function(t,i,s,n,o,r,d){function a(e,s){i[t]._Q.push([e,s])}i[t]||(i[t]={init:function(){a("i",arguments)},fetchBids:function(){a("f",arguments)},setDisplayBids:function(){},targetingKeys:function(){return[]},_Q:[]},(r=s.createElement(n)).async=!0,r.src=o,(d=s.getElementsByTagName(n)[0]).parentNode.insertBefore(r,d),i[t].init({pubID:e.pubID,adServer:"googletag",videoAdServer:"DFP"}))}("apstag",window,document,"script",window.getScriptSrc?window.getScriptSrc("https://c.amazon-adsystem.com/aax2/apstag.js"):"//c.amazon-adsystem.com/aax2/apstag.js"),n.apsTagLoaded=!0)}static onIMAReady(){return this.imaReady.promise}static initializePrebid(e){const t=(e=e||{}).config||{},i=e.analytics||{},s=n.getPrebidS2SAliases(null==t?void 0:t.s2sConfig);s&&s.length&&window.pbjs.que.push((()=>{s.forEach((e=>{var t;null===(t=window.pbjs)||void 0===t||t.aliasBidder(e.bidder,e.alias)}))})),window.pbjs.que.push((()=>{n.prebidInitialized||(i&&i.enabled&&window.pbjs.que.push((()=>{window.pbjs.enableAnalytics({provider:i.provider,options:i.options})})),window.pbjs.setConfig(t),n.prebidInitialized=!0)}))}static setPrebidPageUrl(e){e&&window.pbjs&&window.pbjs.que&&window.pbjs.que.push((()=>{window.pbjs.setConfig({pageUrl:e})}))}static addPrebidAdUnit(e){window.pbjs&&window.pbjs.que&&window.pbjs.que.push((()=>{window.pbjs.addAdUnits(e)}))}static stringToHTMLElement(e){const t=document.createElement("div");return t.innerHTML=e.trim(),t.firstChild}static isIMAPresent(){return window.google&&window.google.ima}static toUrlQueryParameters(e){const t=[];for(const i in e)({}).hasOwnProperty.call(e,i)&&t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return t.join("&")}static extractParamsFromUrl(e){const t=e.split("?");return 2===t.length?n.parseParameters(t[1]):{}}static parseParameters(e){return function(e){const t={};return e.replace(/([^=&]+)=([^&]*)/g,(function(e,i,s){const n=decodeURIComponent(s);n&&"undefined"!==n&&(t[decodeURIComponent(i)]=decodeURIComponent(s))})),t}(e)}static isHTMLElementInViewport(e){var t,i;if(!e)return!1;if(window){const s=e.getBoundingClientRect(),n=window.innerHeight||(null===(t=window.document.documentElement)||void 0===t?void 0:t.clientHeight),o=window.innerWidth||(null===(i=window.document.documentElement)||void 0===i?void 0:i.clientWidth),r=s.top<=n&&s.top+s.height>=0,d=s.left<=o&&s.left+s.width>=0;return s.bottom>0&&s.right>0&&r&&d}return!1}static isHTMLElementVisible(e){return!!e&&(!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&n.isHTMLElementInViewport(e))}static isTabVisible(){var e;return"hidden"!==(null===(e=null===window||void 0===window?void 0:window.document)||void 0===e?void 0:e.visibilityState)}static isFunction(e){return!!(e&&e.constructor&&e.call&&e.apply)}static toUAMAdUnit(e){var t,i,s,o;const r=n.isFunction(e.code)?e.code():e.code;return{slotName:r,slotID:r,sizes:(null===(i=null===(t=e.mediaTypes)||void 0===t?void 0:t.banner)||void 0===i?void 0:i.sizes)||[].concat(null===(o=null===(s=e.mediaTypes)||void 0===s?void 0:s.video)||void 0===o?void 0:o.playerSize)}}static mergeVendorConsents(e,t){null!=e||(e={}),null!=t||(t={});const i=Object.assign(Object.assign({},e),t);return Object.keys(i).forEach((s=>{i[s]=!!e[s]||!!t[s]})),i}static adUnitPath2NetworkAndCode(e){const t=(e||"").split("/").filter(Boolean);return t.length>=2?{network:t[0],code:t[t.length-1]}:null}static getPrebidS2SAliases(e){let t=[];return e&&e.length&&e.forEach((e=>{var i;if(e.enabled&&(null===(i=e.extPrebid)||void 0===i?void 0:i.aliases)){const i=Object.keys(e.extPrebid.aliases).map((t=>({bidder:e.extPrebid.aliases[t],alias:t})));t=t.concat(i)}})),t}static resolveCustomTargeting(e){if(!e)return{};const t={};return Object.entries(e).forEach((([e,i])=>{if("string"==typeof i&&i.trim().startsWith("function")){const e=new Function(`return ${i}`)();let s={};try{s=e.call(window)}catch(e){}if(s&&"object"==typeof s&&!Array.isArray(s)&&Object.keys(s).length>0)for(const[e,i]of Object.entries(s))t[e]=String(i).toString()}else t[e]=String(i).toString()})),t}static checkAdBlock(e){let t="https://www3.doubleclick.net";return e&&e.targetUrl&&(t=e.targetUrl),!1===(null==e?void 0:e.enabled)||"function"!=typeof window.fetch?Promise.resolve(!1):new Promise((i=>{const s=setTimeout((()=>{i(!1)}),(null==e?void 0:e.timeout)||3e3);window.fetch(t,{method:"HEAD",mode:"no-cors",cache:"no-store"}).then((e=>{clearTimeout(s),e.redirected?i(!0):i(!1)})).catch((()=>{clearTimeout(s),i(!0)}))}))}static filterSizesArray(e,t,i){const s=[];return e.forEach((e=>{e[0]<=t&&e[1]<=i&&s.push(e)})),s}}var o,r,d,a,l;n.imaReady=new s,n.GOOGLE_VENDOR_ID=755,n.TCF_P1_CONSENT=1,n.TCF_P4_CONSENT=4,n.DEFAULT_GPT_URL="https://securepubads.g.doubleclick.net/tag/js/gpt.js",n.DEFAULT_PREBID_URL="https://fran-cdn.frvr.com/prebid.7.23.0.js",n.DEFAULT_IMA_URL="https://imasdk.googleapis.com/js/sdkloader/ima3.js",n.DEFAULT_JQUERY_URL="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js",n.DEFAULT_POLLFISH_SDK_URL="https://storage.googleapis.com/pollfish_production/sdk/webplugin/pollfish.min.js",n.prebidLoaded=!1,n.prebidInitialized=!1,n.gptLoaded=!1,n.pubxLoaded=!1,n.imaLoaded=!1,n.apsTagLoaded=!1,n.pollfishLoaded=!1,function(e){e.INTERSTITIAL="interstitial",e.REWARD="reward",e.BANNER="banner",e.SURVEY="survey",e.REWARDED_INTERSTITIAL="rewarded-interstitial"}(o||(o={})),o.INTERSTITIAL,o.REWARD,o.BANNER,o.SURVEY,o.REWARDED_INTERSTITIAL,function(e){e.DELIVERED="delivered",e.COMPLETED="completed"}(r||(r={})),function(e){e.ON_LOAD="on_load",e.ON_SHOW="on_show",e.BLOCKED="blocked",e.NOFILL="nofill",e.TIMED_OUT="timed_out"}(d||(d={})),function(e){e[e.NO_THROTTLING=0]="NO_THROTTLING",e.INIT_TIME="INIT_TIME",e.FREQUENCY="FREQUENCY"}(a||(a={})),function(e){e.DEVELOPMENT="dev",e.BETA="beta",e.PRODUCTION="prod"}(l||(l={}));const c={log:()=>{},error:()=>{},warn:()=>{},info:()=>{},debug:()=>{}};class h{constructor(){this.values={}}setItems(e){return t(this,void 0,void 0,(function*(){for(const t of e)this.values[t.key]=t.value}))}getItems(e){return t(this,void 0,void 0,(function*(){const t={};for(const i of e){const e=this.values[i];void 0!==e&&(t[i]=e)}return t}))}removeItems(e){return t(this,void 0,void 0,(function*(){for(const t of e)delete this.values[t]}))}isPersistent(){return!1}}var u;h.providerName="memory",new class{constructor({provider:e,logger:t}){this.provider=e,this.logger=t||c}setItems(e){const t=e.map((({key:e,value:t})=>({key:e,value:JSON.stringify(t)})));return this.provider.setItems(t)}getItems(e){return t(this,void 0,void 0,(function*(){const t=yield this.provider.getItems(e),i={};for(const e in t)try{i[e]=JSON.parse(t[e])}catch(s){i[e]=t[e],this.logger.error(`[storage] parsing error on key ${e}`,s.message)}return i}))}removeItems(e){return this.provider.removeItems(e)}setItem(e,t){return this.provider.setItems([{key:e,value:JSON.stringify(t)}])}getItem(e,i){return t(this,void 0,void 0,(function*(){let t;const s=(yield this.provider.getItems([e]))[e];try{t=void 0!==s?JSON.parse(s):i}catch(n){t=null!=i?i:s,this.logger.error(`[storage] parsing error on key ${e}`,n.message)}return t}))}removeItem(e){return t(this,void 0,void 0,(function*(){return this.provider.removeItems([e])}))}isPersistent(){return this.provider.isPersistent()}}({provider:new h}),function(e){e[e.None=0]="None",e[e.P1StoreInformationOnADevice=2]="P1StoreInformationOnADevice",e[e.P2SelectBasicAds=4]="P2SelectBasicAds",e[e.P3PersonalizedAdsProfile=8]="P3PersonalizedAdsProfile",e[e.P4PersonalizedAds=16]="P4PersonalizedAds",e[e.P5PersonalizedContentProfile=32]="P5PersonalizedContentProfile",e[e.P6PersonalizedContent=64]="P6PersonalizedContent",e[e.P7MeasureAdPerformance=128]="P7MeasureAdPerformance",e[e.P8MeasureContentPerformance=256]="P8MeasureContentPerformance",e[e.P9MarketResearchForAudienceInsights=512]="P9MarketResearchForAudienceInsights",e[e.P10DevelopAndImproveProducts=1024]="P10DevelopAndImproveProducts",e[e.All=2046]="All"}(u||(u={}));const g={consentToTerms:()=>{},onConsentChanged(e){},hasConsentForAll:(e,t)=>!0,hasConsentForAny:(e,t)=>!0,consents:()=>u.All,legitimateInterests:()=>u.All,hasLoaded:()=>!0,isConsentEditable:()=>!1};var p,v,m,f,w;!function(e){e.AD_CLOSED="adclosed",e.AD_LEAVING_APPLICATION="adleavingapplication",e.CANCELED="canceled",e.ERROR="error",e.INTERNAL_ERROR="internalerror",e.INVALID_REQUEST="invalidrequest",e.NETWORK_ERROR="networkerror",e.NOFILL="nofill",e.SUCCESS="success",e.THROTTLED="throttled",e.TIMEOUT="timeout"}(p||(p={})),function(e){e.ERROR="error",e.NOFILL="nofill",e.SKIPPED="skipped",e.SUCCESS="success",e.TIMEDOUT="timedout"}(v||(v={})),o.INTERSTITIAL,o.REWARD,o.BANNER,function(e){e.NOT_DISPLAYED="not_displayed",e.DELIVERED="delivered",e.COMPLETED="completed"}(m||(m={})),function(e){e.DISPLAY="display",e.VIDEO="video",e.SURVEY="survey"}(f||(f={})),function(e){e.IDFA="idfa",e.GAID="gaid",e.SAMSUNG="tifa"}(w||(w={}));class A{debug(...e){console.debug(JSON.stringify(e))}error(...e){console.error(JSON.stringify(e))}info(...e){console.info(JSON.stringify(e))}log(...e){console.log(JSON.stringify(e))}warn(...e){console.warn(JSON.stringify(e))}}window.pbjs=window.pbjs||{},window.pbjs.que=window.pbjs.que||[],window.googletag=window.googletag||{},window.googletag.cmd=window.googletag.cmd||[];class y{constructor(e,t,i){this.PROVIDER="fran",this.DEFAULT_REFRESH_INTERVAL=61e3,this.hasP1Consent=!0,this.hasP4Consent=!0,this.isInitialized=!1,this.isAdAvailable=!1,this.isPreloadingAd=!1,this.defaultSizes={banner:[[1024,768],[768,1024],[480,320],[336,280],[320,480],[300,600],[300,250],[250,250],[728,90]],video:[[1024,768],[768,1024],[640,480],[640,390],[640,360],[480,320],[400,300],[400,225],[390,640],[320,480]]},this.volume=1,this.defaultTimeoutMS=1500,this.preloadTimeout=null,this.type=e,this.mediaType=t,this.logger=i||new A}getName(){return this.PROVIDER+"#"+this.mediaType}getType(){return this.type}useManualControl(){return!1}init(e,i,s){var r,d,a,l,c,h,u;return t(this,void 0,void 0,(function*(){this.controls=i,this.tracker=s;const t=e.config;if(!(t.adUnit||t.adUnits&&Array.isArray(t.adUnits)&&0!==t.adUnits.length))throw null===(r=this.logger)||void 0===r||r.error(`${this.getFullName()}: adUnit or adUnits is required`),new Error(`${this.getFullName()}: adUnit or adUnits is required`);t.adUnit&&(null!==(d=(h=t.adUnit).timeout)&&void 0!==d||(h.timeout=(null===(l=null===(a=null===window||void 0===window?void 0:window.pbjs)||void 0===a?void 0:a.getConfig)||void 0===l?void 0:l.call(a,"bidderTimeout"))||this.defaultTimeoutMS),t.adUnit.code=n.isFunction(t.adUnit.code)?t.adUnit.code():t.adUnit.code,null!==(c=(u=t.adUnit).uam)&&void 0!==c||(u.uam=!!window.apstag),this.defaultTimeoutMS=t.adUnit.timeout),t.adUnits&&t.adUnits.forEach((e=>{var t,i,s;null!==(t=e.timeout)&&void 0!==t||(e.timeout=(null===(s=null===(i=null===window||void 0===window?void 0:window.pbjs)||void 0===i?void 0:i.getConfig)||void 0===s?void 0:s.call(i,"bidderTimeout"))||this.defaultTimeoutMS),e.code=n.isFunction(e.code)?e.code():e.code,e.timeout>this.defaultTimeoutMS&&(this.defaultTimeoutMS=e.timeout)})),this.config=JSON.parse(JSON.stringify(t)),this.adUnit=t.adUnit,this.adUnits=this.config.adUnits,window.addEventListener("resize",(()=>{this.reset()})),this.adUnit&&this.type!=o.BANNER&&n.filterAdUnitSizes(this.defaultSizes,this.adUnit);if(yield n.checkAdBlock(null==t?void 0:t.adBlockDetection))throw this.isInitialized=!1,new Error(`${this.getFullName()}: ad block detected, disabling provider`);this.isInitialized=!0}))}show(){var e,i;return t(this,void 0,void 0,(function*(){return this.isInitialized?this.isAdAvailable?{success:!0,code:r.COMPLETED}:(null===(i=this.logger)||void 0===i||i.debug(`${this.getFullName()}: no ad available`),{success:!1,code:d.ON_SHOW,message:`${this.getFullName()}: no ad available`}):(null===(e=this.logger)||void 0===e||e.error(`${this.getFullName()}: not initialized, call init()`),{success:!1,code:d.ON_SHOW,message:`${this.getFullName()}: not initialized, call init()`})}))}preload(){var e,i,s;return t(this,void 0,void 0,(function*(){return this.isInitialized?this.isAdAvailable?(null===(i=this.logger)||void 0===i||i.debug(`${this.getFullName()}: an ad is already available`),{success:!1,code:d.ON_LOAD,message:`${this.getFullName()}: an ad is already available`}):(this.isPreloadingAd||(this.isAdAvailable=!1,this.isPreloadingAd=!0,setTimeout((()=>{this.isPreloadingAd&&this.reset()}),1.25*this.defaultTimeoutMS),null===(s=this.logger)||void 0===s||s.debug(`${this.getFullName()}: preloading ad`)),{success:!0,code:r.DELIVERED}):(null===(e=this.logger)||void 0===e||e.error(`${this.getFullName()}: not initialized, call init()`),{success:!1,code:d.ON_LOAD,message:`${this.getFullName()}: not initialized, call init()`})}))}reset(){this.isPreloadingAd=!1,this.isAdAvailable=!1}getFullName(){return this.getName()+"#"+this.getType()}getMediaType(){return this.mediaType}getUserP1Consent(){return this.hasP1Consent}setUserP1Consent(e){this.hasP1Consent=e}getUserP4Consent(){return this.hasP1Consent}setUserP4Consent(e){this.hasP4Consent=e}getVendorConsent(e){return!this.vendorConsents||this.vendorConsents[e]}setVendorConsents(e){this.vendorConsents=e}setDeviceId(e){this.deviceId=e}setPublisherProvidedId(e){this.ppid=e}getDeviceIdTargeting(){if(!this.deviceId)return null;const e={rdid:this.deviceId.value,is_lat:this.getUserP1Consent()?"0":"1"};switch(this.deviceId.type){case w.IDFA:return e.idtype="idfa",e;case w.GAID:return e.idtype="adid",e;case w.SAMSUNG:return e.idtype="tifa",e;default:return null}}getVolume(){return this.volume}setVolume(e){(e<0||e>1)&&(e=1),this.volume=e}getAdUnitCode(){return this.adUnit?n.isFunction(this.adUnit.code)?this.adUnit.code():this.adUnit.code:this.adUnits?this.adUnits.map((e=>e.code)).join(","):void 0}}class S extends y{constructor(e,t){super(e,f.DISPLAY,t),this.adPreloading=null,this.adSlot=null}init(e,i,s){const o=Object.create(null,{init:{get:()=>super.init}});return t(this,void 0,void 0,(function*(){yield o.init.call(this,e,i,s),window.googletag.cmd.push((()=>{this.config.pageUrl&&window.googletag.pubads().set("page_url",this.config.pageUrl),window.googletag.pubads().addEventListener("slotRenderEnded",(e=>{var t,i,s,n;this.adSlot===e.slot&&(this.isAdAvailable=!e.isEmpty,this.isPreloadingAd=!1,this.isAdAvailable?(null===(t=this.logger)||void 0===t||t.debug(`${this.getFullName()}: ad filled`),null===(i=this.tracker)||void 0===i||i.receivedAdResponse(p.SUCCESS,this.getAdUnitCode(),this.getAdSlotTargeting())):(null===(s=this.logger)||void 0===s||s.debug(`${this.getFullName()}: unable to load ad`),null===(n=this.tracker)||void 0===n||n.receivedAdResponse(p.NOFILL,this.getAdUnitCode(),this.getAdSlotTargeting()),this.adPreloading&&(this.adPreloading.resolve({success:!1,code:d.ON_LOAD,message:`${this.getFullName()}: unable to load ad`}),this.adPreloading=null)))})),window.googletag.pubads().disableInitialLoad(),window.googletag.pubads().enableSingleRequest(),window.googletag.enableServices(),this.config.pageUrl&&n.setPrebidPageUrl(this.config.pageUrl)}))}))}reset(){super.reset(),this.adSlot&&window.googletag.destroySlots([this.adSlot]),this.adPreloading&&(this.adPreloading.resolve({success:!1,code:d.ON_LOAD,message:`${this.getFullName()}: unable to load ad`}),this.adPreloading=null)}isReady(){return n.gptLoaded}setTargeting(e){var t,i,s;this.adSlot&&((null===(t=this.config)||void 0===t?void 0:t.customTargeting)&&this.addAdSlotTargeting(n.resolveCustomTargeting(this.config.customTargeting)),this.deviceId&&this.addAdSlotTargeting(this.getDeviceIdTargeting()),this.ppid&&(null===(s=null===(i=null===window||void 0===window?void 0:window.googletag)||void 0===i?void 0:i.pubads)||void 0===s||s.call(i).setPublisherProvidedId(this.ppid)),e&&this.addAdSlotTargeting(e))}getAdSlotTargeting(){if(this.adSlot&&this.adSlot.getTargetingMap()){const e={},t=this.adSlot.getTargetingMap();for(const i in t)if({}.hasOwnProperty.call(t,i)){const s=t[i];e[i]=Array.isArray(s)?s.join():s}return e}return{}}addAdSlotTargeting(e){if(e&&"object"==typeof e&&this.adSlot&&this.adSlot.setTargeting)for(const t in e)e.hasOwnProperty(t)&&this.adSlot.setTargeting(t,e[t])}}class b extends S{constructor(e){super(o.INTERSTITIAL,e),this.adShownPromise=null,this.manualInterstitialEvent=null,this.lastCalled=new Date(-864e13).getTime(),this.THROTTLE_PERIOD_MS=12e4}init(e,i,s){const o=Object.create(null,{init:{get:()=>super.init}});return t(this,void 0,void 0,(function*(){yield o.init.call(this,e,i,s),window.googletag.cmd.push((()=>{window.googletag.pubads().addEventListener("gameManualInterstitialSlotReady",(e=>{this.adSlot===e.slot&&(this.isAdAvailable=!0,this.lastCalled=Date.now(),this.manualInterstitialEvent=e,this.adPreloading&&(this.adPreloading.resolve({success:!0,code:r.DELIVERED}),this.adPreloading=null))})),window.googletag.pubads().addEventListener("gameManualInterstitialSlotClosed",(()=>{var e,t;if(this.isAdAvailable=!1,null===(e=this.tracker)||void 0===e||e.finishedAd(v.SUCCESS,this.getAdUnitCode(),this.getAdSlotTargeting()),this.adShownPromise){const e={success:!0,code:r.COMPLETED};this.adShownPromise.resolve(e),this.adShownPromise=null}null===(t=this.logger)||void 0===t||t.debug(`${this.getFullName()}: ad closed`)}))})),n.addPrebidAdUnit(this.adUnit)}))}preload(){const e=Object.create(null,{preload:{get:()=>super.preload}});var i,o;return t(this,void 0,void 0,(function*(){if(this.isThrottled())return{success:!1,code:d.ON_LOAD,message:`throttled: available in ${(this.THROTTLE_PERIOD_MS-(Date.now()-this.lastCalled))/1e3} seconds`};const t=yield e.preload.call(this);if(t&&t.success){if(!this.getUserP1Consent()||!this.getVendorConsent(n.GOOGLE_VENDOR_ID))return{success:!1,code:d.ON_SHOW,message:"missing required vendor consent"};if(this.adPreloading)return null===(i=this.logger)||void 0===i||i.debug(`${this.getFullName()}: already loading an ad`),{success:!0,code:r.DELIVERED};const e={aps:!1,prebid:!1},t=n.generateUUID(),a=()=>{e.aps&&e.prebid&&l()},l=()=>{window.googletag.cmd.push((()=>{var e;window.googletag.pubads().setRequestNonPersonalizedAds(this.getUserP4Consent()?0:1),window.googletag.pubads().setPrivacySettings({limitedAds:!this.getUserP1Consent()});try{this.setTargeting({hb_aid:t}),window.googletag.pubads().refresh([this.adSlot])}catch(t){this.isPreloadingAd=!1,this.isAdAvailable=!1,null===(e=this.logger)||void 0===e||e.error(t),this.adPreloading&&(this.adPreloading.resolve({success:!1,code:d.ON_LOAD,message:`${this.getFullName()}: unable to send request to ad server - ${t}`}),this.adPreloading=null)}}))},c=()=>{if(!(this.adUnit&&this.adUnit.bids&&this.adUnit.bids.length&&window.pbjs))return e.prebid=!0,void a();window.pbjs.que.push((()=>{const i={auctionId:t,timeout:this.adUnit.timeout,adUnits:[this.adUnit],bidsBackHandler:()=>{window.pbjs.initAdserverSet=!0,window.pbjs.setTargetingForGPTAsync(),e.prebid=!0,a()}};try{window.pbjs.requestBids(i)}catch(t){e.prebid=!0,a()}}))},h=()=>{if(!(this.adUnit&&this.adUnit.uam&&window.apstag))return e.aps=!0,void a();const t=n.toUAMAdUnit(this.adUnit);t.slotID=this.adSlot.getSlotElementId(),window.apstag.fetchBids({slots:[t],timeout:this.adUnit.timeout},(()=>{window.googletag.cmd.push((function(){window.apstag.setDisplayBids(),e.aps=!0,a()}))}))};return null===(o=this.tracker)||void 0===o||o.requestingAd(this.getAdUnitCode(),{hb_aid:t}),window.googletag.cmd.push((()=>{var e;if(window.googletag.destroySlots([this.adSlot]),this.adSlot=window.googletag.defineOutOfPageSlot(this.getAdUnitCode(),window.googletag.enums.OutOfPageFormat.GAME_MANUAL_INTERSTITIAL),!this.adSlot)return null===(e=this.logger)||void 0===e||e.debug(`${this.getFullName()}: unable to create ad slot`),this.isPreloadingAd=!1,this.isAdAvailable=!1,void(this.adPreloading&&(this.adPreloading.resolve({success:!1,code:d.ON_LOAD,message:`${this.getFullName()}: unable to create ad slot`}),this.adPreloading=null));this.adSlot.addService(window.googletag.pubads()),c(),h()})),this.adPreloading=new s,this.adPreloading.promise}return t}))}show(){return t(this,void 0,void 0,(function*(){if(!this.isAdAvailable){const e=yield this.preload();return e&&e.success&&this.isAdAvailable?this.showAd():e}return this.showAd()}))}reset(){if(super.reset(),this.adShownPromise){const e={success:!0,code:r.COMPLETED};this.adShownPromise.resolve(e),this.adShownPromise=null}}canPreload(){return!0}getAdSlot(){return this.adSlot}showAd(){const e=Object.create(null,{show:{get:()=>super.show}});var i,n;return t(this,void 0,void 0,(function*(){const t=yield e.show.call(this);return t&&t.success?this.adShownPromise?(null===(i=this.logger)||void 0===i||i.debug(`${this.getFullName()}: already showing ad`),{success:!0,code:r.COMPLETED}):this.manualInterstitialEvent?(null===(n=this.tracker)||void 0===n||n.willShowAd(!0,this.getAdUnitCode(),this.getAdSlotTargeting()),this.manualInterstitialEvent.makeGameManualInterstitialVisible(),this.adShownPromise=new s,this.adShownPromise.promise):{success:!1,code:d.ON_SHOW,message:`${this.getFullName()}: failed to render ad`}:t}))}isThrottled(){return!(Date.now()-this.lastCalled>this.THROTTLE_PERIOD_MS)}}class P extends S{constructor(e){super(o.REWARD,e),this.rewardSlotEvent=null,this.skipped=!0,this.adShownPromise=null}canPreload(){return!0}init(e,i,s){const n=Object.create(null,{init:{get:()=>super.init}});return t(this,void 0,void 0,(function*(){yield n.init.call(this,e,i,s),window.googletag.cmd.push((()=>{window.googletag.pubads().addEventListener("rewardedSlotReady",(e=>{this.rewardSlotEvent=e,this.adPreloading&&(this.adPreloading.resolve({success:!0,code:r.DELIVERED}),this.adPreloading=null)})),window.googletag.pubads().addEventListener("rewardedSlotGranted",(()=>{this.skipped=!1})),window.googletag.pubads().addEventListener("rewardedSlotClosed",(()=>{var e,t;if(this.isAdAvailable=!1,null===(e=this.logger)||void 0===e||e.debug(`${this.getFullName()}: ad closed, skipped? ${this.skipped}`),null===(t=this.tracker)||void 0===t||t.finishedAd(this.skipped?v.SKIPPED:v.SUCCESS,this.getAdUnitCode()),this.adShownPromise){const e={success:!0,code:this.skipped?r.DELIVERED:r.COMPLETED};this.adShownPromise.resolve(e),this.adShownPromise=null}this.skipped=!0,this.rewardSlotEvent=null}))}))}))}preload(){const e=Object.create(null,{preload:{get:()=>super.preload}});var i;return t(this,void 0,void 0,(function*(){const t=yield e.preload.call(this);return t&&t.success?this.adPreloading?(null===(i=this.logger)||void 0===i||i.debug(`${this.getFullName()}: already loading an ad`),{success:!0,code:r.DELIVERED}):(this.rewardSlotEvent=null,this.skipped=!0,window.googletag.cmd.push((()=>{var e,t;try{window.googletag.pubads().setRequestNonPersonalizedAds(this.getUserP4Consent()?0:1),window.googletag.pubads().setPrivacySettings({limitedAds:!this.getUserP1Consent()}),window.googletag.destroySlots([this.adSlot]),this.adSlot=window.googletag.defineOutOfPageSlot(this.getAdUnitCode(),window.googletag.enums.OutOfPageFormat.REWARDED),this.adSlot.addService(window.googletag.pubads()),this.setTargeting(),null===(e=this.tracker)||void 0===e||e.requestingAd(this.getAdUnitCode()),window.googletag.pubads().refresh([this.adSlot])}catch(e){this.reset(),null===(t=this.logger)||void 0===t||t.error({success:!1,code:d.ON_LOAD,message:JSON.stringify(e)}),this.adPreloading&&(this.adPreloading.resolve({success:!1,code:d.ON_LOAD,message:`${this.getFullName()}: unable to send request to ad server - ${e}`}),this.adPreloading=null)}})),this.adPreloading=new s,this.adPreloading.promise):t}))}show(){return t(this,void 0,void 0,(function*(){if(!this.isAdAvailable){const e=yield this.preload();return e&&e.success&&this.isAdAvailable?this.showAd():e}return this.showAd()}))}reset(){if(super.reset(),this.adShownPromise){const e={success:!0,code:this.skipped?r.DELIVERED:r.COMPLETED};this.adShownPromise.resolve(e),this.adShownPromise=null}this.adPreloading&&(this.adPreloading.resolve({success:!1,code:d.ON_LOAD,message:`${this.getFullName()}: unable to load ad`}),this.adPreloading=null)}showAd(){const e=Object.create(null,{show:{get:()=>super.show}});var i,n;return t(this,void 0,void 0,(function*(){const t=yield e.show.call(this);return t&&t.success?this.adShownPromise?(null===(i=this.logger)||void 0===i||i.debug(`${this.getFullName()}: already showing ad`),{success:!0,code:r.COMPLETED}):this.rewardSlotEvent?(null===(n=this.tracker)||void 0===n||n.willShowAd(!0,this.getAdUnitCode()),this.rewardSlotEvent.makeRewardedVisible(),this.adShownPromise=new s,this.adShownPromise.promise):{success:!1,code:d.ON_SHOW,message:`${this.getFullName()}: failed to render ad`}:t}))}}class E{constructor(e){this.wrapperElement=null,this.videoElement=null,this.adElement=null,this.playing=!1,this.muted=!1,this.videoPlayerConfig=null,this.onToggleCallbacks=[],this.onSoundToggleCallbacks=[],this.toggleVideoElement=null,this.toggleSoundElement=null,this.videoPlayerConfig=e,this.createHTMLElements()}createHTMLElements(){this.wrapperElement=n.stringToHTMLElement("<div></div>");const e='<div><video id="'+this.videoPlayerConfig.id+'" width="'+this.getPlayerWidth()+'px" height="'+this.getPlayerHeight()+'px" playsinline></video></div>',t=n.stringToHTMLElement(e);this.videoElement=t.firstChild,this.adElement=n.stringToHTMLElement("<div style='position: absolute; top:0; min-width: 100%; min-height: 100%;'></div>"),this.toggleVideoElement=n.stringToHTMLElement("<button title='Play/Pause' style='position: absolute;left: 20px;bottom: 16px;height: 30px;width: 65px;font-weight: bold;font-size: 20px; font-family: sans-serif !important; opacity: 0.7;background-color: #fff;border-radius: 5px;border: 1px transparent solid;color: #000;cursor: pointer;line-height: 0;'>II</button>"),this.toggleSoundElement=n.stringToHTMLElement("<button title='Mute/Unmute' style='position: absolute;left: 95px;bottom: 16px;height: 30px;width: 40px;font-weight: bold;font-size: 22px; font-family: sans-serif !important; opacity: 0.7;background-color: #fff;border-radius: 5px;border: 1px transparent solid;color: #000;cursor: pointer;line-height: 0;'>&#x1F50A;</button>"),this.toggleVideoElement.onclick=()=>{this.toggled()},this.toggleSoundElement.onclick=()=>{this.soundToggled()},this.wrapperElement.appendChild(t),this.wrapperElement.appendChild(this.adElement),this.wrapperElement.appendChild(this.toggleVideoElement),this.wrapperElement.appendChild(this.toggleSoundElement)}toggled(){this.playing?this.toggleVideoElement.textContent=String.fromCharCode(9654):this.toggleVideoElement.textContent="II",this.onToggleCallbacks&&this.onToggleCallbacks.length>0&&this.onToggleCallbacks.forEach((e=>{try{e(this.playing)}catch(e){console.error(e)}})),this.playing=!this.playing}soundToggled(){this.muted=!this.muted,this.muted?this.toggleSoundElement.innerHTML="&#x1F507;":this.toggleSoundElement.innerHTML="&#x1F50A;",this.onSoundToggleCallbacks&&this.onSoundToggleCallbacks.length>0&&this.onSoundToggleCallbacks.forEach((e=>{try{e(this.muted)}catch(e){console.error(e)}}))}paused(){this.playing=!1,this.toggleVideoElement.textContent=String.fromCharCode(9654)}resumed(){this.playing=!0,this.toggleVideoElement.textContent="II"}setVolume(e){this.toggleSoundElement.innerHTML=e>0?"&#x1F50A;":"&#x1F507;"}resize(){this.videoElement&&(this.videoElement.setAttribute("width",this.getPlayerWidth()+"px"),this.videoElement.setAttribute("height",this.getPlayerHeight()+"px"))}getVideoHTMLElement(){return this.videoElement}getAdContainerHTMLElement(){return this.adElement}getHTMLWrapper(){return this.wrapperElement}isPlaying(){return this.playing}getPlayerWidth(){return this.videoPlayerConfig.width||n.getBrowserWidth()}getPlayerHeight(){return this.videoPlayerConfig.height||n.getBrowserHeight()}onToggle(e){this.onToggleCallbacks.push(e)}onSoundToggle(e){this.onSoundToggleCallbacks.push(e)}}class I extends y{constructor(e,t){super(e,f.VIDEO,t),this.adsManager=null,this.adsLoader=null,this.adContainer=null,this.skipped=!0,this.isIMAReady=!1,this.adShownPromise=null,this.adPreloading=null,this.videoPlayer=null}init(e,i,s){const r=Object.create(null,{init:{get:()=>super.init}});return t(this,void 0,void 0,(function*(){yield r.init.call(this,e,i,s),n.onIMAReady().then((()=>{this.isIMAReady=!0})),this.videoPlayer=I.buildVideoPlayer(this.adUnit,o.INTERSTITIAL===this.getType()||o.REWARD===this.getType()),this.videoPlayer&&(this.videoPlayer.onToggle((e=>{this.adsManager&&(e?this.adsManager.pause():this.adsManager.resume())})),this.videoPlayer.onSoundToggle((e=>{this.adsManager&&(e?this.adsManager.setVolume(0):this.adsManager.setVolume(this.getVolume()))})),n.addPrebidAdUnit(this.adUnit),this.config.pageUrl&&n.setPrebidPageUrl(this.config.pageUrl),this.config.volume&&this.setVolume(this.config.volume))}))}preload(){const e=Object.create(null,{preload:{get:()=>super.preload}});var i,o,a,l,c;return t(this,void 0,void 0,(function*(){const t=yield e.preload.call(this);if(t&&t.success){if(!this.isIMAReady)return null===(i=this.logger)||void 0===i||i.debug(`${this.getFullName()}: unable to preload, ima sdk isn't ready yet`),this.isAdAvailable=!1,this.isPreloadingAd=!1,{success:!1,code:d.ON_LOAD,message:`${this.getFullName()}: unable to preload, ima sdk isn't ready yet`};if(!this.adsLoader&&!this.initializeIMAComponents())return null===(o=this.logger)||void 0===o||o.debug(`${this.getFullName()}: unable to initialize ima`),this.isAdAvailable=!1,this.isPreloadingAd=!1,{success:!1,code:d.ON_LOAD,message:`${this.getFullName()}:unable to initialize ima`};if(this.adPreloading)return null===(a=this.logger)||void 0===a||a.debug(`${this.getFullName()}: already loading an ad`),{success:!0,code:r.DELIVERED};const e=this.adUnit,t=n.generateUUID(),h=n.resolveCustomTargeting(this.config.customTargeting)||{},u={aps:!1,apsVideoTargeting:null,prebid:!1},g=()=>{u.aps&&u.prebid&&p(v())},p=e=>{try{const t=new window.google.ima.AdsRequest;t.adTagUrl=e,this.config.pageUrl&&(t.pageUrl=this.config.pageUrl),t.linearAdSlotWidth=this.adUnit.mediaTypes.video.playerSize[0],t.linearAdSlotHeight=this.adUnit.mediaTypes.video.playerSize[1],this.adsLoader.requestAds(t)}catch(e){this.isAdAvailable=!1,this.isPreloadingAd=!1,this.logger.error(`${this.getFullName()}: unable to send request to ad server - ${e}`),this.adPreloading&&(this.adPreloading.resolve({success:!1,code:d.ON_LOAD,message:`${this.getFullName()}: unable to send request to ad server - ${e}`}),this.adPreloading=null)}},v=()=>{var i,s,o,r,d,a;const l=u.apsVideoTargeting?n.parseParameters(decodeURIComponent(u.apsVideoTargeting)):{},c={iu:this.getAdUnitCode(),cust_params:Object.assign(Object.assign(Object.assign({},h),{hb_aid:t}),l),output:"vast",vpmute:this.getVolume()>0?0:1};(null===(s=null===(i=this.adUnit.mediaTypes)||void 0===i?void 0:i.video)||void 0===s?void 0:s.maxduration)&&(c.max_ad_duration=1e3*this.adUnit.mediaTypes.video.maxduration),(null===(r=null===(o=this.adUnit.mediaTypes)||void 0===o?void 0:o.video)||void 0===r?void 0:r.minduration)&&(c.min_ad_duration=1e3*this.adUnit.mediaTypes.video.minduration),this.adUnit.mediaTypes.video.startdelay||(this.adUnit.mediaTypes.video.startdelay=0),this.config.pageUrl&&(c.url=this.config.pageUrl,c.description_url=this.config.pageUrl);let g=window.pbjs.adServers.dfp.buildVideoUrl({adUnit:e,params:c});return this.getUserP1Consent()||(g+="&ltd=1"),this.getUserP4Consent()||(g+="&npa=1"),this.getDeviceIdTargeting()&&(g+="&"+n.toUrlQueryParameters(this.getDeviceIdTargeting())),this.ppid&&(g+=`&ppid=${this.ppid}`),g+="&ad_type="+((null===(a=null===(d=this.adUnit.mediaTypes)||void 0===d?void 0:d.video)||void 0===a?void 0:a.skip)?"video":"standardvideo"),g},m=()=>{if(!(this.adUnit&&this.adUnit.bids&&this.adUnit.bids.length&&window.pbjs))return u.prebid=!0,void g();window.pbjs.que.push((()=>{const i={auctionId:t,adUnits:[e],timeout:this.adUnit.timeout,bidsBackHandler:()=>{window.pbjs.initAdserverSet=!0,u.prebid=!0,g()}};try{window.pbjs.requestBids(i)}catch(e){u.prebid=!0,g()}}))},f=()=>{if(!(this.adUnit&&this.adUnit.uam&&window.apstag))return u.aps=!0,void g();const e=n.adUnitPath2NetworkAndCode(this.getAdUnitCode());if(!e)return u.aps=!0,void g();const t={slotID:(i=e.code,i.replaceAll("_","").replaceAll("-","_")),slotName:e.code,mediaType:"video"};var i;window.apstag.fetchBids({slots:[t],timeout:this.adUnit.timeout},(e=>{u.aps=!0,e&&e[0]&&(u.apsVideoTargeting=e[0].encodedQsParams),g()}))};try{null===(l=this.tracker)||void 0===l||l.requestingAd(this.getAdUnitCode(),{hb_aid:t}),m(),f()}catch(e){return void(null===(c=this.logger)||void 0===c||c.error(e))}return this.adPreloading=new s,this.adPreloading.promise}return t}))}show(){const e=Object.create(null,{show:{get:()=>super.show}});var i,n;return t(this,void 0,void 0,(function*(){const t=yield e.show.call(this);return t&&t.success?this.adShownPromise?(null===(i=this.logger)||void 0===i||i.debug(`${this.getFullName()}: already showing ad`),{success:!0,code:r.COMPLETED}):(null===(n=this.tracker)||void 0===n||n.willShowAd(!0,this.getAdUnitCode(),this.getAdSlotParams()),this.adsManager.setVolume(this.getVolume()),this.videoPlayer.setVolume(this.getVolume()),this.adsManager.start(),this.adShownPromise=new s,this.adShownPromise.promise):t}))}reset(){if(super.reset(),this.adsManager&&this.adsManager.destroy(),this.videoPlayer&&this.videoPlayer.resize(),this.adShownPromise){const e={success:!0,code:this.skipped?r.DELIVERED:r.COMPLETED};this.adShownPromise.resolve(e),this.adShownPromise=null}if(this.adPreloading){const e={success:!1,code:d.ON_LOAD,message:`${this.getFullName()}: unable to preload ad`};this.adPreloading.resolve(e),this.adPreloading=null}}canPreload(){return!0}isReady(){return n.isIMAPresent()}isShowingAd(){return!!this.adShownPromise}initializeIMAComponents(){var e,t;if(!n.isIMAPresent())return null===(e=this.logger)||void 0===e||e.debug(`${this.getFullName()}: ima sdk not present`),!1;try{return window.google.ima.settings.setDisableCustomPlaybackForIOS10Plus(!0),this.adContainer=new window.google.ima.AdDisplayContainer(this.videoPlayer.getAdContainerHTMLElement(),this.videoPlayer.getVideoHTMLElement()),this.adContainer.initialize(),this.adsLoader=new window.google.ima.AdsLoader(this.adContainer),this.adsLoader.getSettings().setVpaidMode(window.google.ima.ImaSdkSettings.VpaidMode.INSECURE),this.adsLoader.addEventListener(window.google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,(e=>{const t=new window.google.ima.AdsRenderingSettings;t.restoreCustomPlaybackStateOnAdBreakComplete=!0,this.adsManager=e.getAdsManager(this.videoPlayer.getVideoHTMLElement(),t),this.adsManager.addEventListener(window.google.ima.AdErrorEvent.Type.AD_ERROR,this.handleIMAError.bind(this)),this.adsManager.addEventListener(window.google.ima.AdEvent.Type.ALL_ADS_COMPLETED,this.handleIMAEvent.bind(this)),this.adsManager.addEventListener(window.google.ima.AdEvent.Type.LOADED,this.handleIMAEvent.bind(this)),this.adsManager.addEventListener(window.google.ima.AdEvent.Type.COMPLETE,this.handleIMAEvent.bind(this)),this.adsManager.addEventListener(window.google.ima.AdEvent.Type.SKIPPED,this.handleIMAEvent.bind(this)),this.adsManager.addEventListener(window.google.ima.AdEvent.Type.STARTED,this.handleIMAEvent.bind(this)),this.adsManager.addEventListener(window.google.ima.AdEvent.Type.CLICK,this.handleIMAEvent.bind(this)),this.adsManager.addEventListener(window.google.ima.AdEvent.Type.PAUSED,this.handleIMAEvent.bind(this)),this.adsManager.addEventListener(window.google.ima.AdEvent.Type.RESUMED,this.handleIMAEvent.bind(this));try{this.adsManager.init(this.videoPlayer.getPlayerWidth(),this.videoPlayer.getPlayerHeight(),window.google.ima.ViewMode.FULLSCREEN)}catch(e){this.handleIMAError(e)}}),!1),this.adsLoader.addEventListener(window.google.ima.AdErrorEvent.Type.AD_ERROR,this.handleIMAError.bind(this),!1),!0}catch(e){null===(t=this.logger)||void 0===t||t.debug(`${this.getFullName()}: unable to initialize ima components - ${e}`)}return!1}handleIMAEvent(e){var t,i;switch(e.type){case window.google.ima.AdEvent.Type.LOADED:null===(t=this.logger)||void 0===t||t.debug(`${this.getFullName()}: ad filled`),this.isAdAvailable=!0,this.isPreloadingAd=!1,null===(i=this.tracker)||void 0===i||i.receivedAdResponse(p.SUCCESS,this.getAdUnitCode(),this.getAdSlotParams()),this.adsLoader.__cad=e.getAd(),e.getAd()&&e.getAd().getAdId()&&(window.google.ima.__lads=window.google.ima.__lads||[],window.google.ima.__lads.push(e.getAdData()),window.google.ima.__lads.length>20&&(window.google.ima.__lads=window.google.ima.__lads.slice(window.google.ima.__lads.length-20))),this.adPreloading&&(this.adPreloading.resolve({success:!0,code:r.DELIVERED}),this.adPreloading=null);break;case window.google.ima.AdEvent.Type.SKIPPED:this.skipped=!0,this.adClosed();break;case window.google.ima.AdEvent.Type.COMPLETE:this.skipped=!1,this.adClosed();break;case window.google.ima.AdEvent.Type.STARTED:this.skipped=!0,this.videoPlayer.resumed();break;case window.google.ima.AdEvent.Type.RESUMED:this.videoPlayer.resumed();break;case window.google.ima.AdEvent.Type.PAUSED:this.videoPlayer.paused();break;case window.google.ima.AdEvent.Type.CLICK:this.adsManager&&this.videoPlayer&&this.videoPlayer.isPlaying()&&(this.videoPlayer.paused(),this.adsManager.pause())}}handleIMAError(e){var t,i;if(e&&e.getError&&e.getError().getErrorCode&&1009===e.getError().getErrorCode())return null===(t=this.tracker)||void 0===t||t.receivedAdResponse(p.NOFILL,this.getAdUnitCode(),this.getAdSlotParams()),this.skipped=!0,this.isAdAvailable=!1,this.isPreloadingAd=!1,void(this.adPreloading&&(this.adPreloading.resolve({success:!1,code:d.ON_LOAD,message:`${this.getFullName()}: unable to preload ad`}),this.adPreloading=null));if(this.adShownPromise){const t={success:!1,code:d.ON_SHOW,message:`${e&&e.getError&&e.getError().getMessage?e.getError().getMessage():""}`};this.adShownPromise.resolve(t),this.adShownPromise=null}this.adPreloading&&(this.adPreloading.resolve({success:!1,code:d.ON_LOAD,message:`${this.getFullName()}: unable to preload ad`}),this.adPreloading=null),null===(i=this.logger)||void 0===i||i.error(`${this.getFullName()}: ${e&&e.getError&&e.getError().getMessage?e.getError().getMessage():"unknown error"}`),this.reset()}adClosed(){var e,t;if(null===(e=this.logger)||void 0===e||e.debug(`${this.getFullName()}: ad closed, skipped? ${this.skipped}`),null===(t=this.tracker)||void 0===t||t.finishedAd(this.skipped?v.SKIPPED:v.SUCCESS,this.getAdUnitCode(),this.getAdSlotParams()),this.isAdAvailable=!1,this.videoPlayer.paused(),this.adShownPromise){const e={success:!0,code:this.skipped?r.DELIVERED:r.COMPLETED};this.adShownPromise.resolve(e),this.adShownPromise=null}}getAdSlotParams(){return this.adsLoader&&this.adsLoader.params?this.adsLoader.params:{}}static buildVideoPlayer(e,t){const i={id:n.isFunction(e.code)?e.code():e.code};return t||(i.width=e.mediaTypes.video.playerSize[0],i.height=e.mediaTypes.video.playerSize[1]),new E(i)}}class T{constructor(e){this.contentElement=null,this.modalElement=null,this.createHTMLElements(e)}createHTMLElements(e){const t=document.createElement("div");t.style.cssText="visibility: hidden; position: fixed;top: 0;left: 0;height: 100%;width: 100%;z-index: 9223372036854775807;background-color: rgba(0,0,0,0.85);";const i=document.createElement("div");t.appendChild(i),i.style.cssText="display: flex; align-items: center; justify-content: center; height: 100%; width: 100%; margin: 0; padding: 0; outline: none;";const s=document.createElement("div");if(i.appendChild(s),s.style.cssText="position: relative; margin: 0; outline: none; background-color: #fff; box-shadow: 0px 8px 12px rgb(60 64 67 / 15%), 0px 4px 4px rgb(60 64 67 / 30%); border-radius: 5px;",e){const e=document.createElement("div");s.appendChild(e),e.style.cssText="width: 100%; display: table; height: 24px; background-color: #fff; margin: 0; padding: 0; outline: none;border-radius: 5px 5px 0px 0px;";const t=document.createElement("div");e.appendChild(t),t.style.cssText="float: left; display: table; transition: opacity 1s, background .75s; -webkit-transition: opacity 1s, background .75s; -moz-transition: opacity 1s, background .75s; -o-transition: opacity 1s, background .75s; background: transparent; color: #fff; padding-bottom: 10px; padding-top: 10px;",t.innerHTML="<div style=\"font-size: 14px; font-weight: 700; font-family: 'Roboto', arial, sans-serif; color: #202124; position: relative; height: 25px; padding: 2px 16px 0; float: left; display: table-cell; vertical-align: middle; text-align: center; line-height: 25px;\"> Ad </div>";const i=document.createElement("div");e.appendChild(i),i.style.cssText="color: black; opacity: 0.95; padding: 12px 20px 0; float: right; display: table-cell;vertical-align: middle;",i.setAttribute("aria-label","Close"),i.setAttribute("tabindex","1"),i.innerHTML='<div style="cursor: pointer; display: table-cell;vertical-align: middle;"><svg viewBox="0 0 48 48" fill="#5F6368" style="height: 1.5em; width: 1.5em; margin-left: -0.5em; margin-right: -0.5em; vertical-align: middle; padding-bottom: 1px;"><path d="M38 12.83L35.17 10 24 21.17 12.83 10 10 12.83 21.17 24 10 35.17 12.83 38 24 26.83 35.17 38 38 35.17 26.83 24z"></path><path d="M0 0h48v48H0z" fill="none"></path></svg></div>',i.onclick=this.close.bind(this)}const n=document.createElement("div");s.appendChild(n),n.style.cssText="transition: opacity 1s; -webkit-transition: opacity 1s; position: relative; margin: 0; padding: 0; outline: none; font-size: 0",this.contentElement=n,this.modalElement=t,document.body.appendChild(this.modalElement)}close(){this.modalElement.style.visibility="hidden"}show(){this.modalElement.style.visibility="visible"}addContent(e){const t=document.createElement("div");t.appendChild(e);const i=t.firstChild;return this.contentElement.appendChild(i),i}deleteCreativeContent(){this.contentElement.innerHTML=""}}class C extends I{constructor(e){super(o.INTERSTITIAL,e),this.modal=null}init(e,i,s){const n=Object.create(null,{init:{get:()=>super.init}});return t(this,void 0,void 0,(function*(){yield n.init.call(this,e,i,s),this.modal=new T(!1),this.modal.addContent(this.videoPlayer.getHTMLWrapper())}))}show(){return t(this,void 0,void 0,(function*(){if(!this.isAdAvailable){const e=yield this.preload();return e.success&&this.isAdAvailable?this.showAd():e}return this.showAd()}))}showAd(){const e=Object.create(null,{show:{get:()=>super.show}});return t(this,void 0,void 0,(function*(){this.isAdAvailable&&!this.isShowingAd()&&this.modal.show();try{return yield e.show.call(this)}finally{this.isShowingAd()||this.modal.close()}}))}reset(){super.reset(),this.modal&&this.modal.close()}}class D extends I{constructor(e){super(o.REWARD,e),this.modal=null}init(e,i,s){const n=Object.create(null,{init:{get:()=>super.init}});return t(this,void 0,void 0,(function*(){yield n.init.call(this,e,i,s),this.modal=new T(!1),this.modal.addContent(this.videoPlayer.getHTMLWrapper())}))}show(){return t(this,void 0,void 0,(function*(){if(!this.isAdAvailable){const e=yield this.preload();return e.success&&this.isAdAvailable?this.showAd():e}return this.showAd()}))}showAd(){const e=Object.create(null,{show:{get:()=>super.show}});return t(this,void 0,void 0,(function*(){this.isAdAvailable&&!this.isShowingAd()&&this.modal.show();try{return yield e.show.call(this)}finally{this.isShowingAd()||this.modal.close()}}))}reset(){super.reset(),this.modal&&this.modal.close()}}class R extends y{constructor(e){super(o.BANNER,f.DISPLAY,e),this.banners=[]}init(e,i,s){const o=Object.create(null,{init:{get:()=>super.init}});return t(this,void 0,void 0,(function*(){if(yield o.init.call(this,e,i,s),this.adUnits){const t=[];this.adUnits.forEach((i=>{const s=JSON.parse(JSON.stringify(e));s.config.adUnit=i,s.config.adUnits=null;const o=new L(n.isTabVisible,this.logger);t.push(o.init(s,this.controls,this.tracker).then((()=>{this.banners.push(o)}),(e=>{var t;null===(t=this.logger)||void 0===t||t.error(e)})))})),yield Promise.allSettled(t).then((()=>this.isAdAvailable=!0)),this.scheduledRefresh()}}))}show(){const e=Object.create(null,{show:{get:()=>super.show}});return t(this,void 0,void 0,(function*(){const t=yield e.show.call(this);if(t.success&&this.banners)try{const e=this.banners.filter((e=>e.isVisible()&&e.isRefreshable())),t=e.map((e=>e.show()));this.auction(e),yield Promise.all(t)}catch(e){return{success:!1,code:d.ON_SHOW,message:e.message}}return t}))}auction(e){var t,i;if(!e||e.length<1)return;const s={aps:!1,prebid:!1},o=Math.max(...e.map((e=>e.getAdUnit().timeout))),r=n.generateUUID(),d=()=>{s.aps&&s.prebid&&a()},a=()=>{window.googletag.cmd.push((()=>{var t;window.googletag.pubads().setRequestNonPersonalizedAds(this.getUserP4Consent()?0:1),window.googletag.pubads().setPrivacySettings({limitedAds:!this.getUserP1Consent()}),e.forEach((e=>e.setTargeting({hb_aid:r})));const i=e.map((e=>e.getAdSlot())).filter((e=>e));try{window.googletag.pubads().refresh(i)}catch(i){return e.forEach((e=>e.reset())),void(null===(t=this.logger)||void 0===t||t.error(i))}}))};try{null===(t=this.tracker)||void 0===t||t.requestingAd(this.getFullName(),{hb_aid:r}),(()=>{const t=e.map((e=>e.getAdUnit())).filter((e=>e&&e.bids&&e.bids.length));if(!(t&&t.length&&window.pbjs))return s.prebid=!0,void d();window.pbjs.que.push((()=>{const e={auctionId:r,adUnits:t,timeout:o,bidsBackHandler:()=>{window.googletag.cmd.push((function(){window.pbjs.initAdserverSet=!0,s.prebid=!0,window.pbjs.setTargetingForGPTAsync(),d()}))}};try{window.pbjs.requestBids(e)}catch(e){s.prebid=!0,d()}}))})(),(()=>{const t=e.map((e=>e.getAdUnit())).filter((e=>e&&e.uam)).map((e=>n.toUAMAdUnit(e)));if(!(t&&t.length&&window.apstag))return s.aps=!0,void d();window.apstag.fetchBids({slots:t,timeout:o},(()=>{window.googletag.cmd.push((function(){window.apstag.setDisplayBids(),s.aps=!0,d()}))}))})()}catch(e){return void(null===(i=this.logger)||void 0===i||i.error(e))}}scheduledRefresh(){setTimeout((()=>t(this,void 0,void 0,(function*(){window.pbjs.que.push((()=>{window.googletag.cmd.push((()=>{this.show().finally((()=>this.scheduledRefresh()))}))}))}))),200)}canPreload(){return!1}reset(){}isReady(){return!0}}class L extends S{constructor(e,t){super(o.BANNER,t),this.adShownPromise=null,this.refreshInterval=31e3,this.lastRefreshed=null,this.impressionViewed=!1,this.isTabVisible=e}init(e,i,s){const o=Object.create(null,{init:{get:()=>super.init}});return t(this,void 0,void 0,(function*(){yield o.init.call(this,e,i,s),this.adUnit.refresh&&(this.refreshInterval=this.adUnit.refresh),window.googletag.cmd.push((()=>{var e,t;if(window.googletag.pubads().addEventListener("slotRenderEnded",(e=>{var t;if(this.adSlot===e.slot){if(this.adShownPromise){const t={success:!0,code:r.COMPLETED};this.adShownPromise.resolve(t),this.adShownPromise=null,this.impressionViewed=!!e.isEmpty}null===(t=this.tracker)||void 0===t||t.finishedAd(e.isEmpty?v.NOFILL:v.SUCCESS,this.getAdUnitCode(),this.getAdSlotTargeting())}})),window.googletag.pubads().addEventListener("impressionViewable",(e=>{this.adSlot===e.slot&&(this.impressionViewed=!0)})),this.adSlot=window.googletag.defineSlot(this.getAdUnitCode(),null===(t=null===(e=this.adUnit.mediaTypes)||void 0===e?void 0:e.banner)||void 0===t?void 0:t.sizes,this.getAdUnitCode()),!this.adSlot)throw this.isInitialized=!1,new Error("unable to create banner ad slot");this.adSlot.addService(window.googletag.pubads()),n.addPrebidAdUnit(this.adUnit)}))}))}show(){const e=Object.create(null,{show:{get:()=>super.show}});var i,n;return t(this,void 0,void 0,(function*(){this.isAdAvailable=!0;const t=yield e.show.call(this);return t&&t.success?this.adShownPromise?(null===(i=this.logger)||void 0===i||i.debug(`${this.getFullName()}: already fetching ad`),{success:!1,code:d.ON_SHOW,message:`${this.getFullName()}: already fetching ad`}):(null===(n=this.tracker)||void 0===n||n.willShowAd(!0,this.getAdUnitCode(),this.getAdSlotTargeting()),this.lastRefreshed=new Date,this.adShownPromise=new s,this.adShownPromise.promise):t}))}reset(){if(this.adShownPromise){const e={success:!0,code:r.COMPLETED};this.adShownPromise.resolve(e),this.adShownPromise=null}}canPreload(){return!1}getAdSlotHTMLElement(){var e;if(this.getAdUnitCode())try{return null===(e=null===window||void 0===window?void 0:window.document)||void 0===e?void 0:e.getElementById(this.getAdUnitCode())}catch(e){return null}}getAdUnit(){return this.adUnit}getAdSlot(){return this.adSlot}isVisible(){return this.adSlot&&n.isHTMLElementVisible(this.getAdSlotHTMLElement())}isRefreshable(){return null==this.lastRefreshed||(new Date).getTime()-this.lastRefreshed.getTime()>this.refreshInterval&&this.impressionViewed&&this.isTabVisible()}}class U extends y{constructor(e,t){super(null!=t?t:o.REWARD,f.SURVEY,e),this.skipped=!0,this.adShownPromise=null,this.adPreloading=null,this.eventFields=null}init(e,i,s){const o=Object.create(null,{init:{get:()=>super.init}});return t(this,void 0,void 0,(function*(){yield o.init.call(this,e,i,s),window.pollfishConfig=Object.assign(Object.assign({},window.pollfishConfig||{}),{ready:()=>{},surveyAvailable:this.onSurveyAvailable.bind(this),surveyNotAvailable:this.onSurveyNotAvailable.bind(this),surveyCompletedCallback:this.onSurveyCompleted.bind(this),userNotEligibleCallback:this.onUserDisqualified.bind(this),closeAndNoShowCallback:this.onSurveyCloseAndNoShow.bind(this),closeCallback:this.onSurveyClose.bind(this)}),n.pollfishLoaded&&!this.isAdAvailable&&this.preload()}))}isReady(){return n.pollfishLoaded}canPreload(){return!0}reset(){if(super.reset(),this.adPreloading&&(this.adPreloading.resolve({success:!1,code:d.ON_LOAD,message:`${this.getFullName()}: unable to load ad`}),this.adPreloading=null),this.adShownPromise){const e={success:!0,code:this.skipped?r.DELIVERED:r.COMPLETED};window.Pollfish.hide(),this.adShownPromise.resolve(e),this.adShownPromise=null}}preload(){const e=Object.create(null,{preload:{get:()=>super.preload}});var i,n,o;return t(this,void 0,void 0,(function*(){const t=yield e.preload.call(this);return t&&t.success?(this.adPreloading&&(null===(i=this.logger)||void 0===i||i.debug(`${this.getFullName()}: already loading an ad`),this.adPreloading.promise),this.skipped=!0,null===(n=this.tracker)||void 0===n||n.requestingAd(this.getAdUnitCode()),null===(o=window.Pollfish)||void 0===o||o.restart(window.pollfishConfig),this.adPreloading=new s,this.adPreloading.promise):t}))}show(){var e;return t(this,void 0,void 0,(function*(){if(!this.isAdAvailable&&(null===(e=this.config)||void 0===e?void 0:e.blocking)){const e=yield this.preload();return e&&e.success&&this.isAdAvailable?this.showAd():e}return this.showAd()}))}showAd(){const e=Object.create(null,{show:{get:()=>super.show}});var i,o;return t(this,void 0,void 0,(function*(){const t=yield e.show.call(this);return t&&t.success?this.adShownPromise?(null===(i=this.logger)||void 0===i||i.debug(`${this.getFullName()}: already showing survey`),this.adShownPromise.promise):this.isAdAvailable?(n.overridePollfishContainerZIndex(2147483647),null===(o=this.tracker)||void 0===o||o.willShowAd(!0,this.getAdUnitCode()),window.Pollfish.showFullSurvey(),this.adShownPromise=new s,this.adShownPromise.promise):{success:!1,code:d.ON_SHOW,message:`${this.getFullName()}: failed to render survey`}:(t&&!t.success&&!this.isAdAvailable&&this.isInitialized&&this.preload(),t)}))}onSurveyAvailable(e){var t,i;this.isAdAvailable=!0,this.isPreloadingAd=!1,this.adPreloading&&(this.adPreloading.resolve({success:!0,code:r.DELIVERED}),this.adPreloading=null),null===(t=this.logger)||void 0===t||t.debug(`${this.getFullName()}: ad filled`),this.eventFields={cpm:10*e.revenue,duration:e.survey_loi},null===(i=this.tracker)||void 0===i||i.receivedAdResponse(p.SUCCESS,this.getAdUnitCode(),this.eventFields)}onSurveyNotAvailable(){var e,t;this.isAdAvailable=!1,this.isPreloadingAd=!1,this.eventFields=null,this.adPreloading&&(this.adPreloading.resolve({success:!1,code:d.ON_LOAD,message:`${this.getFullName()}: unable to load ad`}),this.adPreloading=null),null===(e=this.logger)||void 0===e||e.debug(`${this.getFullName()}: unable to load ad`),null===(t=this.tracker)||void 0===t||t.receivedAdResponse(p.NOFILL,this.getAdUnitCode())}onSurveyCompleted(){this.skipped=!1,this.isAdAvailable=!1}onUserDisqualified(){this.skipped=!0,this.isAdAvailable=!1}onSurveyCloseAndNoShow(){this.skipped=!0,this.onSurveyClose()}onSurveyClose(){var e,t;if(null===(e=this.logger)||void 0===e||e.debug(`${this.getFullName()}: survey closed, skipped? ${this.skipped}`),null===(t=this.tracker)||void 0===t||t.finishedAd(this.skipped?v.SKIPPED:v.SUCCESS,this.getAdUnitCode(),this.eventFields),this.skipped||(this.eventFields=null),this.adShownPromise){const e={success:!0,code:this.skipped?r.DELIVERED:r.COMPLETED};this.adShownPromise.resolve(e),this.adShownPromise=null}}}class N extends U{constructor(e){super(e,o.SURVEY)}}class O{constructor(){this.bootstrapMapper={"fran#display#interstitial":{f:O.bootstrapDisplayInterstitial,Type:b},"fran#display#reward":{f:O.bootstrapDisplayReward,Type:P},"fran#display#banner":{f:O.bootstrapDisplayBanner,Type:R},"fran#video#interstitial":{f:O.bootstrapVideoAdProvider,Type:C},"fran#video#reward":{f:O.bootstrapVideoAdProvider,Type:D},"fran#survey#reward":{f:O.bootstrapSurveyAdProvider,Type:U},"fran#survey#survey":{f:O.bootstrapSurveyAdProvider,Type:N}}}bootstrap(e,t){e=e||{};const i=[];return t.forEach((t=>{t in this.bootstrapMapper&&(i.push(new this.bootstrapMapper[t].Type),this.bootstrapMapper[t].f(e))})),i}static bootstrapDisplayInterstitial(e){n.loadGPT(e.gpt),n.loadPubX(e.pubx),n.loadApsTag(e.uam),n.loadPrebid(e.prebid),n.initializePrebid(e.prebid)}static bootstrapDisplayReward(e){n.loadGPT(e.gpt),n.loadPubX(e.pubx)}static bootstrapDisplayBanner(e){n.loadGPT(e.gpt),n.loadPubX(e.pubx),n.loadApsTag(e.uam),n.loadPrebid(e.prebid),n.initializePrebid(e.prebid)}static bootstrapVideoAdProvider(e){n.loadIMA(e.ima),n.loadPubX(e.pubx),n.loadApsTag(e.uam),n.loadPrebid(e.prebid),n.initializePrebid(e.prebid)}static bootstrapSurveyAdProvider(e){n.loadPollfish(e.pollfish)}}class k{ensureInit(e){if(this.adProviders)return;if(!this.isFranConfigured(e))return void(this.adProviders=[]);const t=e.vendors.fran,i=e.providers.map((e=>(this.expandProviderAdUnitCode(e.config),e.name+"#"+e.type))),s=new O;this.adProviders=s.bootstrap(t,i)}getProviders(e){return this.ensureInit(e),this.adProviders}setDeviceId(e){var t;null===(t=this.adProviders)||void 0===t||t.forEach((t=>t.setDeviceId(e)))}setVolume(e){var t;null===(t=this.adProviders)||void 0===t||t.forEach((t=>t.setVolume(e)))}setUserP1Consent(e){var t;null===(t=this.adProviders)||void 0===t||t.forEach((t=>t.setUserP1Consent(e)))}setUserP4Consent(e){var t;null===(t=this.adProviders)||void 0===t||t.forEach((t=>t.setUserP4Consent(e)))}setVendorConsents(e){var t;null===(t=this.adProviders)||void 0===t||t.forEach((t=>t.setVendorConsents(e)))}setChannelId(e){this.channelId=e}isFranConfigured(e){var t;return null!=(null===(t=null==e?void 0:e.vendors)||void 0===t?void 0:t.fran)&&null!=(null==e?void 0:e.providers)}expandProviderAdUnitCode(e){const t=e=>{if(e&&e.code&&this.channelId){const t=k.PARTNER_ID+"-"+this.channelId,i=this.isFunction(e.code)?e.code():e.code,s=i.split("/").pop();e.code=i.replace(s,t+"-"+s)}};e&&e.adUnit&&t(e.adUnit),e&&e.adUnits&&e.adUnits.forEach((e=>t(e)))}isFunction(e){return!!(e&&e.constructor&&e.call&&e.apply)}}k.PARTNER_ID="frvr";class M{constructor(e){this.logger=e}init(){return t(this,void 0,void 0,(function*(){}))}setProgress(e){var t;const i=(100*e).toFixed(1);null===(t=this.logger)||void 0===t||t.info(`[channel-web] progress: ${i}%`)}complete(){var e;return t(this,void 0,void 0,(function*(){null===(e=this.logger)||void 0===e||e.info("[channel-web] complete")}))}}class _ extends Error{constructor(){super(...arguments),this.code="USER_INPUT",this.message="User rejected prompt to add to home screen"}}class x{constructor(e,t){this.logger=e,this.tracker=t,this.calledAlready=!1}init(){return t(this,void 0,void 0,(function*(){"serviceWorker"in navigator&&(navigator.serviceWorker.register("./service-worker.js").then((e=>{var t;null===(t=this.logger)||void 0===t||t.debug("ServiceWorker registration successful with scope: ",e.scope)}),(e=>{var t;null===(t=this.logger)||void 0===t||t.debug("ServiceWorker registration failed: ",e)})),window.addEventListener("beforeinstallprompt",(e=>{var t,i;return null===(t=this.logger)||void 0===t||t.debug("beforeinstallprompt event received: ",e),this.installPromptEvent||(null===(i=this.tracker)||void 0===i||i.logEvent("PWA Before Install Prompt",{}),e.preventDefault(),this.installPromptEvent=e),!1})))}))}canCreateShortcut(){return t(this,void 0,void 0,(function*(){return!!this.installPromptEvent&&!this.calledAlready}))}createShortcut(){var e,i,s,n;return t(this,void 0,void 0,(function*(){null===(e=this.tracker)||void 0===e||e.logEvent("PWA Install Prompt",{}),this.calledAlready=!0;const t=yield this.installPromptEvent.prompt();if(null===(i=this.logger)||void 0===i||i.debug("PWA Install Prompt returned: ",t),"accepted"!==t.outcome)throw null===(n=this.tracker)||void 0===n||n.logEvent("PWA Dismissed",{}),new _;null===(s=this.tracker)||void 0===s||s.logEvent("PWA Installed",{})}))}}class F{isIOS(){return/(ipod|iphone|ipad)/i.test(navigator.userAgent)||/(Macintosh)/i.test(navigator.userAgent)&&"ontouchend"in document}isAndroid(){return/(android)/i.test(navigator.userAgent)&&!/(Windows)/i.test(navigator.userAgent)}configure(e){this.config=e}needsConfiguration(){return!0}canMoveToMobile(){var e,i;return t(this,void 0,void 0,(function*(){return!(!(this.isIOS()&&(null===(e=this.config)||void 0===e?void 0:e.iosAppId)||this.isAndroid())||!(null===(i=this.config)||void 0===i?void 0:i.id))}))}moveToMobile(){return t(this,void 0,void 0,(function*(){const e=this.config;if(this.isIOS())window.location.href="https://apps.apple.com/app/"+(null==e?void 0:e.id)+"/id"+(null==e?void 0:e.iosAppId)+"?mt=1";else if(this.isAndroid()){const t="https://play.google.com/store/apps/details?id=com.frvr."+(null==e?void 0:e.id);navigator&&navigator.getInstalledRelatedApps?navigator.getInstalledRelatedApps().then((function(i){i.length>0?window.location.href=`intent://${null==e?void 0:e.id}/#Intent;scheme=frvr;package=com.frvr.${null==e?void 0:e.id};end`:window.location.href=t})).catch((function(){console.warn("Related Apps API is not supported. Redirecting to Google Play."),window.location.href=t})):window.location.href=t}}))}}class j{getData(){return t(this,void 0,void 0,(function*(){return this.getEntryPointData()}))}getProperty(e){var i,s;return t(this,void 0,void 0,(function*(){return null!==(s=null===(i=this.getEntryPointData())||void 0===i?void 0:i[e])&&void 0!==s?s:void 0}))}getName(){return t(this,void 0,void 0,(function*(){return this.getProperty("name")}))}getEntryPointData(){if(this.entrypointData)return this.entrypointData;try{this.entrypointData=Object.fromEntries(new URLSearchParams(window.location.search))}catch(e){this.entrypointData={}}return this.entrypointData}}class B{constructor(e){this.config=e}canNavigate(){return!0}navigate(e,i){return t(this,void 0,void 0,(function*(){window.open(e,i||"_blank")}))}canOpenChannelAppStore(){return!0}openChannelAppStore(){return t(this,void 0,void 0,(function*(){this.navigate(`https://${this.config.gameId}.frvr.com`,"_self")}))}}class V{constructor(e,t){this.pixelId=e,this.logger=t,this.hasInitEventBeenSent=!1}init(e){return t(this,void 0,void 0,(function*(){this.addFacebookMetaPixelQueue(),e.onConsentChanged((e=>{(e&V.REQUIRED_CONSENT_FLAGS)===V.REQUIRED_CONSENT_FLAGS&&this.addFacebookMetaPixelLoader()}))}))}getName(){return"metapixel"}send(e,t,i,s){switch(e){case"page_loading":this.fbqTrack("PageView");break;case"iap_request_payment_success":this.fbqTrack("Purchase",{currency:i.currencyCode,value:i.priceValue})}}fbqTrack(e,t){var i,s,n;window.fbq?(this.hasInitEventBeenSent||(null===(s=this.logger)||void 0===s||s.debug("[metapixel-analytics] tracking fbq event","init",this.pixelId),window.fbq("init",this.pixelId),this.hasInitEventBeenSent=!0),null===(n=this.logger)||void 0===n||n.debug("[metapixel-analytics] tracking fbq event",e,t),void 0!==t?window.fbq("track",e,t):window.fbq("track",e)):null===(i=this.logger)||void 0===i||i.error("[metapixel-analytics] window.fbq not found, enqueueing event")}addFacebookMetaPixelQueue(){var e;if(window.fbq)return;null===(e=this.logger)||void 0===e||e.debug("[metapixel-analytics] installing metapixel queue");this.appendScript("\n    !function(f,b,e,v,n,t,s)\n    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?\n    n.callMethod.apply(n,arguments):n.queue.push(arguments)};\n    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';\n    n.queue=[];}(window, document,'script',\n    'https://connect.facebook.net/en_US/fbevents.js');\n    ")}addFacebookMetaPixelLoader(){var e;if(this.hasScriptLoaderBeenAppended)return;null===(e=this.logger)||void 0===e||e.debug("[metapixel-analytics] installing metapixel loader");this.appendScript("\n    !function(f,b,e,v,n,t,s)\n    {t=b.createElement(e);t.async=!0;\n    t.src=v;s=b.getElementsByTagName(e)[0];\n    s.parentNode.insertBefore(t,s)}(window, document,'script',\n    'https://connect.facebook.net/en_US/fbevents.js');\n    "),this.hasScriptLoaderBeenAppended=!0}appendScript(e){const t=document.createElement("script"),i=document.createTextNode(e);t.appendChild(i);window.document.getElementsByTagName("head")[0].appendChild(t)}}V.REQUIRED_CONSENT_FLAGS=e.ConsentOptions.P4PersonalizedAds|e.ConsentOptions.P5PersonalizedContentProfile|e.ConsentOptions.P7MeasureAdPerformance,function(){for(var e=[],t=0;64>t;)e[t]=0|4294967296*Math.abs(Math.sin(++t))}();class ${constructor(e,t){this.auth=t,this.baseUrl=e.replace(/\/$/,"")}getAllPlayerObjects(e,i,s){var n;return t(this,void 0,void 0,(function*(){const t=new URLSearchParams;void 0!==s&&t.set("keys",null!=s?s:"");const o=t.toString(),r=yield null===(n=this.auth)||void 0===n?void 0:n.authenticatedFetch(`${this.baseUrl}/player/${e}/${i}?${o}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new z(r);return yield r.json()}))}createPlayerObject(e,i,s){var n;return t(this,void 0,void 0,(function*(){const t=yield null===(n=this.auth)||void 0===n?void 0:n.authenticatedFetch(`${this.baseUrl}/player/${e}/${i}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!t.ok)throw new z(t);return yield t.json()}))}updatePlayerObject(e,i,s,n){var o;return t(this,void 0,void 0,(function*(){const t=yield null===(o=this.auth)||void 0===o?void 0:o.authenticatedFetch(`${this.baseUrl}/player/${e}/${i}/${s}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!t.ok)throw new z(t);return yield t.json()}))}deletePlayerObject(e,i,s,n){var o;return t(this,void 0,void 0,(function*(){const t=yield null===(o=this.auth)||void 0===o?void 0:o.authenticatedFetch(`${this.baseUrl}/player/${e}/${i}/${s}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!t.ok)throw new z(t);return yield t.json()}))}}class z extends Error{constructor(e){super(e.statusText),this.response=e,this.response=e,this.name="ResponseError"}}const H={[l.PRODUCTION]:"https://crucible.frvr.com/v1/storage",[l.BETA]:"https://staging.crucible.frvr.com/v1/storage",[l.DEVELOPMENT]:"https://staging.crucible.frvr.com/v1/storage"};class K{constructor(e,t,i){var s,n,o;const r=null!==(s=null==t?void 0:t.overrideURL)&&void 0!==s?s:H[e];this.gameId=t.gameId,this.logger=null==i?void 0:i.logger,this.auth=i.auth,null===(n=this.logger)||void 0===n||n.log(`[frvr-sdk] Player Storage for game ${this.gameId} on ${r}`);const d=null!==(o=i.clientBuilder)&&void 0!==o?o:e=>new $(e,this.auth);this.client=d(r,this.auth)}setItems(e){return t(this,void 0,void 0,(function*(){const t=e.map((e=>this.upsertItem(e.key,e.value)));yield Promise.allSettled(t)}))}getItems(e){return t(this,void 0,void 0,(function*(){const t=(yield this.client.getAllPlayerObjects(this.getUserId(),this.gameId,e.join(","))).items.map((e=>[e.key,e.data]));return Object.fromEntries(t)}))}removeItems(e){return t(this,void 0,void 0,(function*(){const t=this.getUserId(),i=e.map((e=>this.client.deletePlayerObject(t,this.gameId,e,void 0)));yield Promise.allSettled(i)}))}isPersistent(){return!0}getAllItems(){return t(this,void 0,void 0,(function*(){const e=(yield this.client.getAllPlayerObjects(this.getUserId(),this.gameId)).items.map((e=>[e.key,e.data]));return Object.fromEntries(e)}))}upsertItem(e,i){return t(this,void 0,void 0,(function*(){const t=this.getUserId();try{yield this.client.updatePlayerObject(t,this.gameId,e,{version:void 0,data:i})}catch(s){yield this.client.createPlayerObject(t,this.gameId,{key:e,data:i})}}))}getUserId(){return this.auth.getFRVRID()}}class G{constructor({id:e,contextID:t,endTime:i,startTime:s,title:n,payload:o,offset:r,players:d,type:a,count:l}){this.id=e,this.contextID=t,i&&(this.endTime=i),s&&(this.startTime=s),this.title=n,this.payload=o,this.offset=r,this.count=l,d&&(this.players=d),a&&(this.type=a)}}class W{constructor(e){this.id=e.id,this.name=e.name,this.photo=e.photo,this.rank=e.rank,e.updated&&(this.updated=e.updated),this.score=e.score,this.payload=e.payload}}const q={[l.PRODUCTION]:"https://crucible.frvr.com",[l.BETA]:"https://staging.crucible.frvr.com",[l.DEVELOPMENT]:"https://staging.crucible.frvr.com"};class Y{constructor(e){this.channel=e}init(e,t){this.apiUrl=q[t],this.gameId=e,this.leaderboards={}}createLeaderboard(e,i){return t(this,void 0,void 0,(function*(){const t=`${this.apiUrl}/v1/leaderboards`,s={game:this.gameId,title:i.title,endTime:i.endTime,type:e||"default",data:i.payload,sortOrder:i.sortOrder||"HIGHER_IS_BETTER"};i.id&&(s.id=i.id);const n=yield fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),o=yield n.json();if(!n.ok)throw new Error(o.error.message);return o.id}))}getLeaderboard(e,i=30,s=0){return t(this,void 0,void 0,(function*(){const t=`${this.apiUrl}/v1/leaderboards/${this.gameId}/${e}`,n={count:i.toString(),offset:s.toString()},o=yield fetch(t+"?"+new URLSearchParams(n)),r=yield o.json();if(!o.ok)throw new Error(r.error.message);r.payload=r.data;const d=r.players?r.players.map((t=>{const i=new W(t);return i.score=this.cacheScore(e,i.id,i.score),i})):[];return r.players=d,new G(r)}))}getLeaderboardEntry(e,i){return t(this,void 0,void 0,(function*(){const t=`${this.apiUrl}/v1/leaderboards/${this.gameId}/${e}/${i}`,s={platform:this.channel},n=yield fetch(t+"?"+new URLSearchParams(s)),o=yield n.json();if(!n.ok)throw new Error(o.error.message);return o.payload=o.data,o.score=this.cacheScore(e,i,o.score),new W(o)}))}submitScore(e,i,s,n,o){return t(this,void 0,void 0,(function*(){this.cacheScore(e,i,s);const t=`${this.apiUrl}/v1/leaderboards/${this.gameId}/${e}`,r={id:i,score:s,platform:this.channel};n&&(r.name=n),o&&(r.photo=o);const d=yield fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),a=yield d.json();if(!d.ok)throw new Error(a.error.message);return a}))}getAllLeaderboardsIdsOfType(e){return t(this,void 0,void 0,(function*(){return(yield this.getAllLeaderboardsOfType(Object.assign(Object.assign({},e),{verbose:!1}))).ids||[]}))}getAllLeaderboardsDataOfType(e){return t(this,void 0,void 0,(function*(){return(yield this.getAllLeaderboardsOfType(Object.assign(Object.assign({},e),{verbose:!0}))).leaderboards||[]}))}getLeaderboardEntries(e,i){return t(this,void 0,void 0,(function*(){if(!i.length)return[];const t=`${this.apiUrl}/v1/leaderboards/${this.gameId}/${e}/entries`,s={platform:this.channel,players:i.join(",")},n=yield fetch(t+"?"+new URLSearchParams(s)),o=yield n.json();if(!n.ok)throw new Error(o.error.message);return((null==o?void 0:o.entries)||[]).map((t=>(t.payload=t.data,t.score=this.cacheScore(e,t.id,t.score),new W(t))))}))}getAllLeaderboardsOfType({type:e,playerId:i,sortBy:s="created",sortOrder:n="desc",count:o=30,offset:r=0,verbose:d=!1}){return t(this,void 0,void 0,(function*(){const t=`${this.apiUrl}/v1/players/${this.gameId}/${i}`,a={type:e,platform:this.channel,sortOrder:n,sortBy:s,count:o.toString(),offset:r.toString(),verbose:d?"true":"false"},l=yield fetch(t+"?"+new URLSearchParams(a)),c=yield l.json();if(!l.ok)throw new Error(c.error.message);return c}))}cacheScore(e,t,i){this.leaderboards[e]||(this.leaderboards[e]={scores:{}});const s=this.leaderboards[e].scores[t];return void 0!==s&&s>i&&(i=s),this.leaderboards[e].scores[t]=i,i}}var X;!function(e){e[e.create=0]="create",e[e.getCurrentTournament=1]="getCurrentTournament",e[e.getActiveTournaments=2]="getActiveTournaments",e[e.postScore=3]="postScore",e[e.join=4]="join",e[e.leave=5]="leave",e[e.share=6]="share",e[e.invitePlayers=7]="invitePlayers"}(X||(X={}));const J={isSupported:()=>!1,getSupportedAPIs:()=>[],getLeaderboardsChannelId:()=>"empty",getCurrentTournament(){return t(this,void 0,void 0,(function*(){return null}))},create(){return t(this,void 0,void 0,(function*(){return null}))},postScore(){return t(this,void 0,void 0,(function*(){}))},share(){return t(this,void 0,void 0,(function*(){}))},getActiveTournaments(){return t(this,void 0,void 0,(function*(){return[]}))},join(){return t(this,void 0,void 0,(function*(){}))},leave(){return t(this,void 0,void 0,(function*(){}))},invitePlayers(){return t(this,void 0,void 0,(function*(){}))}};class Z{constructor(e,t){this.consentsBitSet=u.None,this.legitimateInterestsBitSet=u.None,this.consentIsLoaded=!1,this.getName=()=>"TcfV2ConsentProvider",this.logger=t,this.onConsentChangedHandlers=[],this.loadConsentManagementPlatform(e)}tcfDataBitSet2ConsentOptionsBitSet(e){let t=0;for(const i in e)e[i]&&(t|=1<<Number(i));return t}onLoad(){var e;if(window.__tcfapi){null===(e=this.logger)||void 0===e||e.log(`${this.getName()}::onLoad()`);const t=(e,t)=>{var i,s,n;t?"useractioncomplete"!==e.eventStatus&&"tcloaded"!==e.eventStatus||(this.consentIsLoaded=!0,this.consentsBitSet=this.tcfDataBitSet2ConsentOptionsBitSet(null!==(s=e.purpose.consents)&&void 0!==s?s:{}),this.legitimateInterestsBitSet=this.tcfDataBitSet2ConsentOptionsBitSet(null!==(n=e.purpose.legitimateInterests)&&void 0!==n?n:{}),this.dispatchConsentChanged(this.consentsBitSet,this.legitimateInterestsBitSet)):null===(i=this.logger)||void 0===i||i.warn(`${this.getName()}::onLoad::updateConsentCallback:!success`)};window.__tcfapi("addEventListener",2,t)}}dispatchConsentChanged(e,t){for(let i=0;i<this.onConsentChangedHandlers.length;i++)this.onConsentChangedHandlers[i](e,t)}hasLoaded(){return this.consentIsLoaded}isConsentEditable(){return!0}loadConsentManagementPlatform(e){let t=1;const i=()=>{window.__tcfapi?this.onLoad():(setTimeout(i,t),t*=2,t>4e3&&(t=4e3))};i()}consentToTerms(){var e;null===(e=this.logger)||void 0===e||e.warn(`${this.getName()}::consentToTerms(NoOpImpl)`)}onConsentChanged(e){this.onConsentChangedHandlers.push(e),this.consentIsLoaded&&e(this.consentsBitSet,this.legitimateInterestsBitSet)}hasConsentForAny(e,t=u.None){return this.hasLoaded()&&0!=(this.consentsBitSet&e)}hasConsentForAll(e,t=u.None){return this.hasLoaded()&&(this.consentsBitSet&e)==e}consents(){return this.consentsBitSet}legitimateInterests(){return this.legitimateInterestsBitSet}}class Q extends Z{constructor(e,t){super(e,t),this.scriptIsLoaded=!1,this.getName=()=>"CookieproConsentProvider"}loadConsentManagementPlatform(e){const t=document.createElement("script");t.type="text/javascript",t.src="https://cookie-cdn.cookiepro.com/scripttemplates/otSDKStub.js",t.setAttribute("data-domain-script",e.websiteKey),t.async=!0,t.defer=!0,t.onload=()=>{this.scriptIsLoaded||(this.scriptIsLoaded=!0,super.loadConsentManagementPlatform(e))},document.head.appendChild(t);const i=document.createElement("script");t.type="text/javascript",i.innerHTML="function OptanonWrapper() { }",document.head.appendChild(i);const s=document.createElement("style");s.setAttribute("type","text/css"),s.textContent="div#ot-sdk-btn-floating { display: none !important; }",document.head.appendChild(s)}consentToTerms(){var e;this.hasLoaded()&&(null===(e=window.OneTrust)||void 0===e||e.ToggleInfoDisplay())}}class ee{constructor(e){this.targetOrigin=e}init(){return t(this,void 0,void 0,(function*(){}))}getName(){return"post-message"}send(e,t,i,s){const n={debug:!0,event:e,text:"Some text",fields:i};console.log(`[ QA Tool Post Message (${this.targetOrigin})] ${n.event} - ${JSON.stringify(n.fields)}`),window.parent.postMessage(n,"*")}}class te{constructor(e,t,i,s){this.leaderboardClient=e,this.logger=t,this.auth=i,this.profile=s}init(e,t){this.leaderboardClient.init(e,t)}isSupported(){return!0}getAllLeaderboards(){return t(this,void 0,void 0,(function*(){const e=this.auth.getFRVRID(),t=yield this.leaderboardClient.getAllLeaderboardsIdsOfType({type:"TOURNAMENT",playerId:e});return Promise.all(t.map((e=>this.getLeaderboard(e))))}))}getLeaderboardEntries(e,t){return this.leaderboardClient.getLeaderboardEntries(e,t)}getLeaderboardEntry(e,t){return this.leaderboardClient.getLeaderboardEntry(e,t)}getLeaderboard(e,t,i){return this.leaderboardClient.getLeaderboard(e,t,i)}postScore(e,i){var s,n;return t(this,void 0,void 0,(function*(){if(!e)return void this.logger.error("missing leaderboard id");const t=this.auth.getFRVRID();if(!t)return void this.logger.error("missing player id");const o=null===(s=this.profile)||void 0===s?void 0:s.name();if(!o)return void this.logger.error("missing player name");const r=null===(n=this.profile)||void 0===n?void 0:n.image();yield this.leaderboardClient.submitScore(e,t,i,o,r)}))}}class ie{constructor(t,i){this.adConfigProvider=t,this.fran=i,this.entryPointProvider=new j,this.adConfigProvider=t,this.fran=null!=i?i:new k,this.fran.setChannelId(this.getMappedChannel()),this.characteristics=Object.assign(Object.assign({},e.defaultCharacteristics),{hasDedicatedLoadingScreen:!1})}onModulesUpdated({logger:e,tracker:t,auth:i}){this.logger=e,this.tracker=t,this.auth=i,this.buildConsentProvider(),this.buildAdConfigProvider()}buildAdConfigProvider(){!this.adConfigProvider&&this.logger&&(this.adConfigProvider=new i(this.getPlatform(),this.getMappedChannel(),this.logger))}buildConsentProvider(){var e;if(this.consentProvider||!(null===(e=this.consentConfig)||void 0===e?void 0:e.providerName)||!this.logger)return;const{providerName:t,config:i}=this.consentConfig;if("tcfv2"===t)this.consentProvider=new Z(i,this.logger);else if("cookiepro"===t){if(!i)throw new Error("missing config for cookiepro");this.consentProvider=new Q(i,this.logger)}}setConfig(e){this.gameId=e.gameId,this.consentConfig=e.consent}getId(){return"web"}getPlatform(){return"web"}getMappedChannel(){return e.inMemoryChannelMapper.getChannel()}getBootstrapper(){return new M(this.logger)}getConsentProvider(){var e;return null!==(e=this.consentProvider)&&void 0!==e?e:g}getAnalyticsProviders(t,i){var s;if(i===e.Env.DEVELOPMENT){const e=new ee("https://localhost:3000");return new URLSearchParams(window.location.search).has("qatoolEnabled")?[e]:[]}const n={pixelId:null===(s=null==t?void 0:t.metapixel)||void 0===s?void 0:s.pixelId},o=n.pixelId&&new V(n.pixelId),r=new ee("https://beta.frvr.com"),d=new URLSearchParams(window.location.search);return[new e.FRVRAnalytics({disableSendBeacon:!this.characteristics.allowSendBeacon}),...d.has("qatoolEnabled")?[r]:[],...o?[o]:[]]}getAnalyticsIDProvider(t){return new e.WebIDProvider(t)}getAdsProviders(e){return[...this.fran.getProviders(e)]}getShortcutProvider(){return new x(this.logger,this.tracker)}getLocalStorageProvider(){return e.buildStorageProvider([e.WebLocalStorageProvider.providerName,h.providerName])}getCloudStorageProvider(e,i){return t(this,void 0,void 0,(function*(){return new K(i,Object.assign({gameId:this.gameId},null==e?void 0:e.playerStorage),{auth:this.auth,logger:this.logger})}))}getTrackerContextProvider(t){return e.buildTrackerWebContextProvider(t)}getCrossplay(){return new F}getCharacteristics(){return this.characteristics}getEntryPointProvider(){return this.entryPointProvider}getAdsConfig(e){var i;return t(this,void 0,void 0,(function*(){if(!(null==e?void 0:e.remote))return e;if(!this.gameId)throw new Error("Game ID is not set");try{return yield this.adConfigProvider.get(this.gameId)}catch(e){null===(i=this.logger)||void 0===i||i.error(e)}return e}))}getLeaderboardsProvider(){return new te(new Y(this.getId()),this.logger,this.auth)}getTournamentsProvider(){return e=this.getId(),Object.assign(Object.assign({},J),{getLeaderboardsChannelId:()=>e});var e}getNavigationProvider(e){return new B(e)}}class se{getName(){return"crazygames"}isReady(){var e,t,i;return void 0!==(null===(i=null===(t=null===(e=window.CrazyGames)||void 0===e?void 0:e.CrazySDK)||void 0===t?void 0:t.getInstance)||void 0===i?void 0:i.call(t))}useManualControl(){return!1}init(i,s,n){return t(this,void 0,void 0,(function*(){this.adTracker=n;const t=this.getCrazyGamesInstance();if(!t)throw new Error("CrazyGames SDK not available");t.addEventListener("adStarted",(()=>{this.adTracker.receivedAdResponse(e.AdResponseStatus.SUCCESS),this.adTracker.willShowAd(!1)})),t.addEventListener("adFinished",(()=>{this.adTracker.finishedAd(e.AdFinishedStatus.SUCCESS)})),t.addEventListener("adError",(()=>{this.adTracker.receivedAdResponse(e.AdResponseStatus.ERROR),this.adTracker.finishedAd(e.AdFinishedStatus.ERROR)}))}))}setUserConsent(e){}show(){return new Promise(((t,i)=>{const s=this.getCrazyGamesInstance();if(!s)return void i(new Error("CrazyGames SDK not available"));let n=!1;const o=()=>{n=!0},r=()=>{a(),t({success:!0,code:this.getAdSuccessCode()})},d=()=>{a(),i({success:!1,code:n?e.AdError.ON_SHOW:e.AdError.ON_LOAD})},a=()=>{s.removeEventListener("adStarted",o),s.removeEventListener("adFinished",r),s.removeEventListener("adError",d)};s.addEventListener("adStarted",o),s.addEventListener("adFinished",r),s.addEventListener("adError",d),this.adTracker.requestingAd(),s.requestAd(this.getCrazyGamesAdType())}))}getCrazyGamesInstance(){var e,t,i;return null===(i=null===(t=null===(e=window.CrazyGames)||void 0===e?void 0:e.CrazySDK)||void 0===t?void 0:t.getInstance)||void 0===i?void 0:i.call(t)}}class ne extends se{constructor(){super(...arguments),this.CRAZYGAMES_INTERSTITIAL_TYPE="midgame"}getType(){return e.AdType.INTERSTITIAL}getCrazyGamesAdType(){return this.CRAZYGAMES_INTERSTITIAL_TYPE}getAdSuccessCode(){return e.AdSuccess.DELIVERED}}class oe extends se{constructor(){super(...arguments),this.CRAZYGAMES_REWARDED_TYPE="rewarded"}getType(){return e.AdType.REWARD}getCrazyGamesAdType(){return this.CRAZYGAMES_REWARDED_TYPE}getAdSuccessCode(){return e.AdSuccess.COMPLETED}}function re(e,t){return new Promise((i=>{let s=document.getElementById(t);s?i():(s=document.createElement("script"),s.setAttribute("id",t),s.setAttribute("type","text/javascript"),s.setAttribute("src",e),document.getElementsByTagName("head")[0].appendChild(s),s.onload=()=>i())}))}function de(e,t,i){return new Promise(((s,n)=>{let o,r=0;!function d(){if(r++>t)return o&&clearTimeout(o),void n(new Error("Retry limit exceeded"));e().then((e=>{if(void 0!==e)return o&&clearTimeout(o),void s(e);o=setTimeout(d,i)})).catch((()=>{o=setTimeout(d,i)}))}()}))}class ae{constructor(e){this.logger=e}init(){var e;return t(this,void 0,void 0,(function*(){for(this.logger.info("CrazyGames bootstrapper init"),yield re("https://sdk.crazygames.com/crazygames-sdk-v1.js","crazySdkScript");!(null===(e=window.CrazyGames)||void 0===e?void 0:e.CrazySDK);)yield new Promise((e=>setTimeout(e,100)));const t=window.CrazyGames.CrazySDK.getInstance();t.init(),yield new Promise((e=>{t.addEventListener("initialized",(()=>{e()}))}))}))}setProgress(e){}complete(){return t(this,void 0,void 0,(function*(){}))}}class le extends ie{constructor(e,t){super(e,t)}getId(){return"crazygames"}getBootstrapper(){return new ae(this.logger)}getAdsProviders(e){return super.getAdsProviders(e).concat([new ne,new oe])}}class ce{constructor(){this.isHolding=!0}getType(){return e.AdType.INTERSTITIAL}getName(){return"microsoft"}isReady(){return!!this.adInstance}init(e,i,s){return t(this,void 0,void 0,(function*(){this.adTracker=s,setTimeout((()=>this.preload()),3e3),this.startHoldingPeriod()}))}startHoldingPeriod(){this.isHolding=!0,setTimeout((()=>this.isHolding=!1),3e4)}preload(){if(!this.adInstance)return this.loadingPromise||(this.loadingPromise=de((()=>this.load()),5,2500).catch((()=>{this.adTracker.receivedAdResponse(e.AdResponseStatus.NOFILL)})).finally((()=>{this.loadingPromise=void 0}))),this.loadingPromise}load(){return t(this,void 0,void 0,(function*(){this.adTracker.requestingAd();const i=yield function(e,i){return t(this,void 0,void 0,(function*(){return yield Promise.race([e,new Promise((e=>setTimeout(e,i)))])}))}($msstart.loadAdsAsync({canBackfill:!0}),5e3);if(null==i?void 0:i.instanceId)return this.adInstance=i,this.adTracker.receivedAdResponse(e.AdResponseStatus.SUCCESS,i.instanceId),i;this.adTracker.receivedAdResponse(e.AdResponseStatus.NOFILL)}))}show(){return t(this,void 0,void 0,(function*(){if(this.isHolding)return{success:!1,code:e.AdError.BLOCKED,message:"In holding period"};const t=!!this.adInstance;if(t||(yield this.preload()),!this.adInstance)return{success:!1,code:e.AdError.NOFILL,message:"No ad instance"};const i=this.adInstance;let s;this.adTracker.willShowAd(t,i.instanceId);try{s=yield $msstart.showAdsAsync(i.instanceId),this.adInstance=void 0,yield s.showAdsCompletedAsync}catch(t){return{success:!1,code:e.AdError.ON_SHOW,message:t.message}}return this.preload(),this.startHoldingPeriod(),{success:!0,code:e.AdSuccess.COMPLETED}}))}useManualControl(){return!1}}var he;!function(e){e.TOP="top:320x50",e.BOTTOM="bottom:320x50"}(he||(he={}));class ue{constructor(){this.initialized=!1}getType(){return e.AdType.BANNER}getName(){return"microsoft"}hide(){return t(this,void 0,void 0,(function*(){yield $msstart.hideDisplayAdsAsync(),this.adTracker.finishedAd(e.AdFinishedStatus.SUCCESS)}))}init(e,i,s){return t(this,void 0,void 0,(function*(){this.adTracker=s,this.initialized=!0}))}isReady(){return this.initialized}show(){return t(this,void 0,void 0,(function*(){try{return yield $msstart.showDisplayAdsAsync(he.BOTTOM),this.adTracker.receivedAdResponse(e.AdResponseStatus.SUCCESS),this.adTracker.willShowAd(!1),{success:!0,code:e.AdSuccess.COMPLETED}}catch(t){const i=t;return this.adTracker.receivedAdResponse(e.AdResponseStatus.ERROR),this.adTracker.finishedAd(e.AdFinishedStatus.ERROR),{success:!1,code:e.AdError.ON_SHOW,message:i.description}}}))}useManualControl(){return!0}}class ge{constructor(e,t,i){this.logger=e,this.entryPoint=t,this.tracker=i}init(){var e;return t(this,void 0,void 0,(function*(){if(this.logger.info("Microsoft PWA bootstrapper init"),yield re("https://assets.msn.com/staticsb/statics/latest/msstart-games-sdk/msstart-v1.0.0-rc.13.min.js","msPwaSdkScript"),!(null===(e=null===$msstart||void 0===$msstart?void 0:$msstart.isInMicrosoftStart)||void 0===e?void 0:e.call($msstart)))throw new Error("Not running in Microsoft Start environment");this.logger.info("Running in Microsoft Start environment");const t=yield this.entryPoint.getData();this.tracker.logEvent("entry_point",{channel:"microsoft",entry_point_id:t.entryPointId,entry_point_name:t.entryPointName})}))}setProgress(e){}complete(){return t(this,void 0,void 0,(function*(){}))}}class pe{constructor(e){this.tracker=e}init(){return t(this,void 0,void 0,(function*(){}))}canCreateShortcut(){return t(this,void 0,void 0,(function*(){return $msstart.isInMicrosoftStart()}))}createShortcut(){return t(this,void 0,void 0,(function*(){switch(yield $msstart.promptInstallAsync()){case"PROMPT_INSTALL_ACCEPTED":this.tracker.logEvent("ms_promp_install_successfull",{});break;case"PROMPT_INSTALL_DISMISSED":this.tracker.logEvent("ms_promp_install_dismissed",{})}}))}}class ve{getData(){return t(this,void 0,void 0,(function*(){return this.getMSEntryPoint()}))}getName(){var e;return t(this,void 0,void 0,(function*(){return null===(e=this.getMSEntryPoint())||void 0===e?void 0:e.entryPointName}))}getMSEntryPoint(){if(this.msEntrypoint)return this.msEntrypoint;if(!(null===$msstart||void 0===$msstart?void 0:$msstart.isInMicrosoftStart()))throw new Error("Not running in Microsoft Start environment");return this.msEntrypoint=$msstart.getEntryPointInfo(),this.msEntrypoint}}var me,fe;!function(e){e.FRVR="frvr",e.ANONYMOUS="anonymous",e.FACEBOOK_INSTANT="facebook-instant",e.FACEBOOK_SDK="facebook-web",e.GOOGLE_INTERNAL="google-internal",e.SAMSUNG_INSTANT="samsung-instant",e.APPLE="apple",e.DISCORD="discord",e.MICROSOFT="microsoft"}(me||(me={}));class we{constructor(){this.loggingIn=!0,this.available=!1}getPlatformId(){return me.MICROSOFT}init(){return t(this,void 0,void 0,(function*(){this.credentials=yield this.fetchCredentials(),this.loggingIn=!1}))}getCredentials(){return this.credentials}getLoginSignature(){var e;return t(this,void 0,void 0,(function*(){return null===(e=this.credentials)||void 0===e?void 0:e.signature}))}getUserID(){var e;return t(this,void 0,void 0,(function*(){return null===(e=this.credentials)||void 0===e?void 0:e.playerId}))}isLoggedIn(){return!!this.credentials}isLoggingIn(){return this.loggingIn}isLoginSupported(){return this.available}isLogoutSupported(){return!1}login(){return t(this,void 0,void 0,(function*(){return this.loggingIn=!0,this.credentials=yield this.requestLogin(),this.loggingIn=!1,!!this.credentials}))}logout(){}prohibitsLoginWithFRVRCredentials(){return!1}requestLogin(){return t(this,void 0,void 0,(function*(){try{return yield $msstart.signInAsync()}catch(e){this.available=this.checkAvailable(e.code)}}))}fetchCredentials(){return t(this,void 0,void 0,(function*(){try{const e=yield $msstart.getSignedInUserAsync();return this.available=!0,e}catch(e){this.available=this.checkAvailable(e.code)}}))}checkAvailable(e){return!["USER_NOT_ELIGIBLE","API_ACCESS_DENIED"].includes(e)}}class Ae extends ie{constructor(t,i){super(t,i),this.entryPoint=new ve,this.consentProvider=e.consentToAllConsentProvider}getId(){return"microsoft"}getBootstrapper(){return new ge(this.logger,this.entryPoint,this.tracker)}getAdsProviders(e){return[new ce,new ue,...super.getAdsProviders(e)]}getAdsConfig(e){const i=Object.create(null,{getAdsConfig:{get:()=>super.getAdsConfig}});return t(this,void 0,void 0,(function*(){if(!(null==e?void 0:e.remote))return e;const t=yield i.getAdsConfig.call(this,e);return this.mergedAdsConfig(e,t)}))}mergedAdsConfig(e,t){const i=[];for(const s of e.providers){const e=t.providers.find((e=>e.name===s.name&&e.type===s.type));e?i.push(Object.assign(Object.assign({},e),{priority:s.priority})):i.push(s)}return{autoInit:e.autoInit,remote:e.remote,version:t.version,vendors:t.vendors,throttling:e.throttling,providers:i}}getAuthProviders(e,t){return[new we]}getShortcutProvider(){return new pe(this.tracker)}getEntryPointProvider(){return this.entryPoint}}!function(e){e.UNKNOWN="UNKNOWN",e.USER_INPUT="USER_INPUT",e.INVALID_PARAM="INVALID_PARAM"}(fe||(fe={}));class ye{constructor(e,t){this.states={},this._isReady=!1,this.requiredStates=e,this.handler=t;for(const e of this.requiredStates)this.states[e]=!1;this.updateIsReady()}updateIsReady(){const e=this._isReady;this._isReady=this.requiredStates.every((e=>this.states[e])),e!=this._isReady&&this.handler(this._isReady)}setState(e,t){this.states[e]=t,this.updateIsReady()}getState(e){return this.states[e]}get isReady(){return this._isReady}}const Se="discord";var be;!function(e){e.AED="aed",e.AFN="afn",e.ALL="all",e.AMD="amd",e.ANG="ang",e.AOA="aoa",e.ARS="ars",e.AUD="aud",e.AWG="awg",e.AZN="azn",e.BAM="bam",e.BBD="bbd",e.BDT="bdt",e.BGN="bgn",e.BHD="bhd",e.BIF="bif",e.BMD="bmd",e.BND="bnd",e.BOB="bob",e.BOV="bov",e.BRL="brl",e.BSD="bsd",e.BTN="btn",e.BWP="bwp",e.BYN="byn",e.BYR="byr",e.BZD="bzd",e.CAD="cad",e.CDF="cdf",e.CHE="che",e.CHF="chf",e.CHW="chw",e.CLF="clf",e.CLP="clp",e.CNY="cny",e.COP="cop",e.COU="cou",e.CRC="crc",e.CUC="cuc",e.CUP="cup",e.CVE="cve",e.CZK="czk",e.DJF="djf",e.DKK="dkk",e.DOP="dop",e.DZD="dzd",e.EGP="egp",e.ERN="ern",e.ETB="etb",e.EUR="eur",e.FJD="fjd",e.FKP="fkp",e.GBP="gbp",e.GEL="gel",e.GHS="ghs",e.GIP="gip",e.GMD="gmd",e.GNF="gnf",e.GTQ="gtq",e.GYD="gyd",e.HKD="hkd",e.HNL="hnl",e.HRK="hrk",e.HTG="htg",e.HUF="huf",e.IDR="idr",e.ILS="ils",e.INR="inr",e.IQD="iqd",e.IRR="irr",e.ISK="isk",e.JMD="jmd",e.JOD="jod",e.JPY="jpy",e.KES="kes",e.KGS="kgs",e.KHR="khr",e.KMF="kmf",e.KPW="kpw",e.KRW="krw",e.KWD="kwd",e.KYD="kyd",e.KZT="kzt",e.LAK="lak",e.LBP="lbp",e.LKR="lkr",e.LRD="lrd",e.LSL="lsl",e.LTL="ltl",e.LVL="lvl",e.LYD="lyd",e.MAD="mad",e.MDL="mdl",e.MGA="mga",e.MKD="mkd",e.MMK="mmk",e.MNT="mnt",e.MOP="mop",e.MRO="mro",e.MUR="mur",e.MVR="mvr",e.MWK="mwk",e.MXN="mxn",e.MXV="mxv",e.MYR="myr",e.MZN="mzn",e.NAD="nad",e.NGN="ngn",e.NIO="nio",e.NOK="nok",e.NPR="npr",e.NZD="nzd",e.OMR="omr",e.PAB="pab",e.PEN="pen",e.PGK="pgk",e.PHP="php",e.PKR="pkr",e.PLN="pln",e.PYG="pyg",e.QAR="qar",e.RON="ron",e.RSD="rsd",e.RUB="rub",e.RWF="rwf",e.SAR="sar",e.SBD="sbd",e.SCR="scr",e.SDG="sdg",e.SEK="sek",e.SGD="sgd",e.SHP="shp",e.SLL="sll",e.SOS="sos",e.SRD="srd",e.SSP="ssp",e.STD="std",e.SVC="svc",e.SYP="syp",e.SZL="szl",e.THB="thb",e.TJS="tjs",e.TMT="tmt",e.TND="tnd",e.TOP="top",e.TRY="try",e.TTD="ttd",e.TWD="twd",e.TZS="tzs",e.UAH="uah",e.UGX="ugx",e.USD="usd",e.USN="usn",e.USS="uss",e.UYI="uyi",e.UYU="uyu",e.UZS="uzs",e.VEF="vef",e.VND="vnd",e.VUV="vuv",e.WST="wst",e.XAF="xaf",e.XAG="xag",e.XAU="xau",e.XBA="xba",e.XBB="xbb",e.XBC="xbc",e.XBD="xbd",e.XCD="xcd",e.XDR="xdr",e.XFU="xfu",e.XOF="xof",e.XPD="xpd",e.XPF="xpf",e.XPT="xpt",e.XSU="xsu",e.XTS="xts",e.XUA="xua",e.YER="yer",e.ZAR="zar",e.ZMW="zmw",e.ZWL="zwl"}(be||(be={}));const Pe={[be.AED]:2,[be.AFN]:2,[be.ALL]:2,[be.AMD]:2,[be.ANG]:2,[be.AOA]:2,[be.ARS]:2,[be.AUD]:2,[be.AWG]:2,[be.AZN]:2,[be.BAM]:2,[be.BBD]:2,[be.BDT]:2,[be.BGN]:2,[be.BHD]:3,[be.BIF]:0,[be.BMD]:2,[be.BND]:2,[be.BOB]:2,[be.BOV]:2,[be.BRL]:2,[be.BSD]:2,[be.BTN]:2,[be.BWP]:2,[be.BYR]:0,[be.BYN]:2,[be.BZD]:2,[be.CAD]:2,[be.CDF]:2,[be.CHE]:2,[be.CHF]:2,[be.CHW]:2,[be.CLF]:0,[be.CLP]:0,[be.CNY]:2,[be.COP]:2,[be.COU]:2,[be.CRC]:2,[be.CUC]:2,[be.CUP]:2,[be.CVE]:2,[be.CZK]:2,[be.DJF]:0,[be.DKK]:2,[be.DOP]:2,[be.DZD]:2,[be.EGP]:2,[be.ERN]:2,[be.ETB]:2,[be.EUR]:2,[be.FJD]:2,[be.FKP]:2,[be.GBP]:2,[be.GEL]:2,[be.GHS]:2,[be.GIP]:2,[be.GMD]:2,[be.GNF]:0,[be.GTQ]:2,[be.GYD]:2,[be.HKD]:2,[be.HNL]:2,[be.HRK]:2,[be.HTG]:2,[be.HUF]:2,[be.IDR]:2,[be.ILS]:2,[be.INR]:2,[be.IQD]:3,[be.IRR]:2,[be.ISK]:0,[be.JMD]:2,[be.JOD]:3,[be.JPY]:0,[be.KES]:2,[be.KGS]:2,[be.KHR]:2,[be.KMF]:0,[be.KPW]:2,[be.KRW]:0,[be.KWD]:3,[be.KYD]:2,[be.KZT]:2,[be.LAK]:2,[be.LBP]:2,[be.LKR]:2,[be.LRD]:2,[be.LSL]:2,[be.LTL]:2,[be.LVL]:2,[be.LYD]:3,[be.MAD]:2,[be.MDL]:2,[be.MGA]:2,[be.MKD]:2,[be.MMK]:2,[be.MNT]:2,[be.MOP]:2,[be.MRO]:2,[be.MUR]:2,[be.MVR]:2,[be.MWK]:2,[be.MXN]:2,[be.MXV]:2,[be.MYR]:2,[be.MZN]:2,[be.NAD]:2,[be.NGN]:2,[be.NIO]:2,[be.NOK]:2,[be.NPR]:2,[be.NZD]:2,[be.OMR]:3,[be.PAB]:2,[be.PEN]:2,[be.PGK]:2,[be.PHP]:2,[be.PKR]:2,[be.PLN]:2,[be.PYG]:0,[be.QAR]:2,[be.RON]:2,[be.RSD]:2,[be.RUB]:2,[be.RWF]:0,[be.SAR]:2,[be.SBD]:2,[be.SCR]:2,[be.SDG]:2,[be.SEK]:2,[be.SGD]:2,[be.SHP]:2,[be.SLL]:2,[be.SOS]:2,[be.SRD]:2,[be.SSP]:2,[be.STD]:2,[be.SVC]:2,[be.SYP]:2,[be.SZL]:2,[be.THB]:2,[be.TJS]:2,[be.TMT]:2,[be.TND]:3,[be.TOP]:2,[be.TRY]:2,[be.TTD]:2,[be.TWD]:2,[be.TZS]:2,[be.UAH]:2,[be.UGX]:0,[be.USD]:2,[be.USN]:2,[be.USS]:2,[be.UYI]:0,[be.UYU]:2,[be.UZS]:2,[be.VEF]:2,[be.VND]:0,[be.VUV]:0,[be.WST]:2,[be.XAF]:0,[be.XAG]:0,[be.XAU]:0,[be.XBA]:0,[be.XBB]:0,[be.XBC]:0,[be.XBD]:0,[be.XCD]:2,[be.XDR]:0,[be.XFU]:0,[be.XOF]:0,[be.XPD]:0,[be.XPF]:0,[be.XPT]:0,[be.XSU]:0,[be.XTS]:0,[be.XUA]:0,[be.YER]:2,[be.ZAR]:2,[be.ZMW]:2,[be.ZWL]:2};var Ee,Ie,Te={convertToPriceValue:function(e){const{amount:t,currency:i}=e,s=Pe[i];return null==s?(console.warn(`Unexpected currency ${i}`),t):t/Math.pow(10,s)}};!function(e){e[e.ONGOING=1]="ONGOING",e[e.STANDBY=0]="STANDBY"}(Ee||(Ee={})),function(e){e.IsCatalogLoaded="isCatalogLoaded",e.IsIAPInitialized="isIAPInitialized"}(Ie||(Ie={}));class Ce{constructor(e,t){this.serviceClient=e,this.logger=t,this.completedEntitlements=[],this.name=Se,this.isPurchaseSubscribed=!1;const i=[Ie.IsCatalogLoaded,Ie.IsIAPInitialized];this.isReadyManager=new ye(i,(e=>{this.isReadyStateChanged(e)}))}isReadyStateChanged(e){this.onIsReadyHandler&&this.onIsReadyHandler(e)}onIsReadyChanged(e){this.onIsReadyHandler=e}getName(){return this.name}isReady(){return!(!this.isReadyManager.isReady||!window.discordSDK)}init(){var e,i,s;return t(this,void 0,void 0,(function*(){null===(e=this.logger)||void 0===e||e.info("[Discord - IAP]: Executing init"),null===(i=this.logger)||void 0===i||i.info("[Discord - IAP]: Executing iapReady."),this.isReadyManager.getState(Ie.IsIAPInitialized)||(null===(s=this.logger)||void 0===s||s.info("[Discord - IAP]: Will load catalog."),yield this.loadDiscordCatalog(),this.isReadyManager.setState(Ie.IsIAPInitialized,!0))}))}loadDiscordCatalog(){var e,i;return t(this,void 0,void 0,(function*(){try{const t=yield this.serviceClient.getProducts();if(!t)throw new Error("[Discord - IAP]: Products not found in IAP service");const i=t,{skus:s}=yield window.discordSDK.commands.getSkus(),n=s;if(null===(e=this.logger)||void 0===e||e.info("[Discord - IAP]: Loaded items catalog.",n),!n)throw new Error("[Discord - IAP]: No Discord SKUs found");const o=[],r=new Map(n.map((e=>[e.id,e])));for(let e=0;e<i.length;e++){const t=window.discordSDK.clientId,s=r.get(i[e].channels.discord.skus[`${t}`]);s&&o.push(Object.assign(Object.assign({},s),{productId:i[e].sku,name:i[e].name}))}if(o.length<=0)throw new Error("[Discord - IAP]: Something went wrong creating the catalog");this.catalog=o,this.isReadyManager.setState(Ie.IsCatalogLoaded,!0)}catch(e){null===(i=this.logger)||void 0===i||i.error("[Discord - IAP]: Could not get product list: ",e)}}))}configure(){return t(this,void 0,void 0,(function*(){}))}getProductById(e){var t;let i;if(this.catalog){const s=this.catalog.find((t=>t.productId===e));s&&(i={provider:this.name,trackingName:s.name,label:s.name,priceValue:Te.convertToPriceValue(s.price),currencyCode:null===(t=s.price)||void 0===t?void 0:t.currency})}return i}getProductBySkuId(e){var t;let i;if(this.catalog){const s=this.catalog.find((t=>t.id===e));s&&(i={provider:this.name,skuId:s.id,productId:s.productId,trackingName:s.name,label:s.name,priceValue:Te.convertToPriceValue(s.price),currencyCode:null===(t=s.price)||void 0===t?void 0:t.currency})}return i}getSkuForProduct(e){if(this.catalog){const t=this.catalog.find((t=>t.productId===e));if(t)return t.id}}getSkuType(e){if(this.catalog){const t=this.catalog.find((t=>t.productId===e));if(t)return t.type}}getCatalog(){const e={};for(const t of this.catalog)e[t.productId]={label:t.name,storeId:t.productId};return e}purchase(e,i){return t(this,void 0,void 0,(function*(){if(!this.getProductById(e))throw new Error("[Discord - IAP]: Product not found in catalog");return this.isPurchaseSubscribed||(this.isPurchaseSubscribed=!0,window.discordSDK.subscribe("ENTITLEMENT_CREATE",this.handlePurchaseComplete.bind(this))),window.discordSDK.commands.startPurchase({sku_id:this.getSkuForProduct(e)}).then((i=>t(this,void 0,void 0,(function*(){var t;if(null===(t=this.logger)||void 0===t||t.info("[Discord - IAP]: purchase resolved.",i),i.length>1)throw new Error("[Discord - IAP]: Multiple entitlements found");const s=i[0];return new De(Object.assign({productId:e},s))}))))}))}consumePurchase(e){return t(this,void 0,void 0,(function*(){if(2!==this.getSkuType(e.productId))return this.serviceClient.consumePurchase(e.transactionReceipt.applicationId,e.purchaseId).then((e=>{})).catch((t=>{var i;throw null===(i=this.logger)||void 0===i||i.log("[Discord - IAP]: error validating purchase",e,t),new Error("[Discord - IAP]: error consuming purchase")}))}))}getUnconsumedPurchases(){return t(this,void 0,void 0,(function*(){return window.discordSDK.commands.getEntitlements().then((({entitlements:e})=>{var t;null===(t=this.logger)||void 0===t||t.info("[Discord - IAP]: Loaded inventory items.",e);const i=e.filter((e=>!(e.consumed||e.deleted))).map((e=>{var t;const i=this.getProductBySkuId(e.sku_id);if(i)return new De(Object.assign({productId:i.productId},e));null===(t=this.logger)||void 0===t||t.log("[Discord - IAP]: product with given sku does not exist")}));return i}))}))}handlePurchaseComplete(e){var i;return t(this,void 0,void 0,(function*(){null===(i=this.logger)||void 0===i||i.log("[Discord - IAP]: handlePurchaseComplete event",e);const t=this.getProductBySkuId(e.entitlement.sku_id);yield this.validatePurchase(Object.assign(Object.assign({},e.entitlement),{productId:t.productId}))}))}validatePurchase(e){const t={transactionId:e.id,discordUserId:e.user_id,skuId:e.sku_id,applicationId:e.application_id,productId:e.productId};return this.serviceClient.validatePurchase(t).then((e=>{var t;return null===(t=this.logger)||void 0===t||t.log("[Discord - IAP]: validate purchase response",e),e})).catch((e=>{throw new Error("[Discord - IAP]: error validating purchase",e)}))}}class De{constructor(e){this.channelId=Se,this.productId=e.productId,this.purchaseId=e.id,this.transactionReceipt={transactionId:e.id,discordUserId:e.user_id,skuId:e.sku_id,applicationId:e.application_id,productId:e.productId}}}class Re{constructor(e){this.logger=e}init(){return t(this,void 0,void 0,(function*(){}))}setProgress(e){var t;const i=(100*e).toFixed(1);null===(t=this.logger)||void 0===t||t.info(`[channel-web] progress: ${i}%`)}complete(){var e;return t(this,void 0,void 0,(function*(){null===(e=this.logger)||void 0===e||e.info("[channel-web] complete")}))}}const Le=1006;class Ue{constructor(e,t,i,s){this.platformId=me.DISCORD,this._isLoggingIn=!0,this.isAuthorized=!1,this._isLoggedIn=!1,this.discordAppID=i,this.logger=s}init(e){return t(this,void 0,void 0,(function*(){this._isLoggingIn=!1,this.authFRVR=e,yield this.doLoginChain()}))}handleFailedAuth(){setTimeout((()=>{var e;null===(e=this.logger)||void 0===e||e.warn("[Discord.auth] App auth failed and proceeding to close app"),window.discordSDK.close(Le,"Authentication or authorization failure")}),300)}doLoginChain(){return t(this,void 0,void 0,(function*(){return de((()=>this.retrieveClientSignature().then((()=>{if(this.isAuthorized&&this.credentials)return this.authFRVR.loginWithProvider(this);throw new Error("[Discord.auth] Authorization failed")})).catch((e=>{var t,i;if(null===(t=this.logger)||void 0===t||t.error("[Discord.auth] Login Chain error in FRVR login",e),!this.isAuthorized)return null===(i=this.logger)||void 0===i||i.log("[Discord.auth] Authorization failed"),this.handleFailedAuth();throw e})).then((()=>{var e;return null===(e=this.logger)||void 0===e||e.log("[Discord.auth] Login Chain FRVR login final step",this._isLoggedIn),this._isLoggedIn||void 0}))),20,300).catch((()=>{var e;null===(e=this.logger)||void 0===e||e.error("[Discord.auth] Max login attempts reached"),this._isLoggingIn=!1,this.credentials=null,this.handleFailedAuth()}))}))}retrieveClientSignature(){return t(this,void 0,void 0,(function*(){yield window.discordSDK.commands.authorize({client_id:this.discordAppID,response_type:"code",state:"",prompt:"none",scope:["rpc.voice.read","rpc.activities.write","guilds","guilds.members.read","identify"]}).then((e=>{var t;null===(t=this.logger)||void 0===t||t.log("[Discord.auth] retrieveClientSignature. Authorize_RPC Response:",e),this.isAuthorized=!0,this.credentials={code:e.code,appId:this.discordAppID}})).catch((e=>{var t;throw null===(t=this.logger)||void 0===t||t.error("[Discord.auth] retrieveClientSignature. Authorize_RPC Error:",e),this.isAuthorized=!1,this._isLoggingIn=!1,this.credentials=null,e})).finally((()=>{this._isLoggingIn=!1}))}))}onFRVRTokensReceived(e){var i;return t(this,void 0,void 0,(function*(){const t=null===(i=e.getRefreshPayload())||void 0===i?void 0:i.extra;if("discord"!==t.platform)return;const s=(null==t?void 0:t.credentials).accessToken;if(this.credentials.userId=null==t?void 0:t.identifier,this.isAuthorized&&s){let e;yield window.discordSDK.commands.authenticate({access_token:s}).then((t=>{var i;return null===(i=this.logger)||void 0===i||i.log("[Discord.auth] onFRVRTokensReceived: Authenticate_RPC Response:",t),e=t.user,window.discordSDK.commands.getInstanceConnectedParticipants()})).then((({participants:t})=>{var i;const s=null==t?void 0:t.find((t=>t.id===e.id));window.discordSDK._FRVRPatched_user=Object.assign({nickname:null!==(i=s.nickname)&&void 0!==i?i:s.global_name},e),this._isLoggedIn=!0})).catch((e=>{var t;if(4002==e.code)return null===(t=this.logger)||void 0===t||t.log("[Discord.auth] onFRVRTokensReceived: Already authenticated"),this._isLoggedIn=!0,!0;throw e}))}}))}getPlatformId(){return this.platformId}handlesFRVRLogin(){return!0}isLoginSupported(){return!1}isLogoutSupported(){return!1}prohibitsLoginWithFRVRCredentials(){return!0}isLoggingIn(){return this._isLoggingIn}getCredentials(){return this.credentials}getLoginSignature(){var e;return t(this,void 0,void 0,(function*(){return null===(e=this.credentials)||void 0===e?void 0:e.code}))}getUserID(){var e;return t(this,void 0,void 0,(function*(){return null===(e=this.credentials)||void 0===e?void 0:e.userId}))}isLoggedIn(){return this._isLoggedIn}login(){return t(this,void 0,void 0,(function*(){return!1}))}logout(){}}const Ne=(e,t)=>null===t?null:"https://cdn.discordapp.com/avatars/"+e+"/"+t+".png";class Oe{id(){var e;return null===(e=this.getDiscordUserData())||void 0===e?void 0:e.id}name(){var e;return null===(e=this.getDiscordUserData())||void 0===e?void 0:e.username}nickname(){var e;return null===(e=this.getDiscordUserData())||void 0===e?void 0:e.nickname}image(){var e;const t=this.id(),i=null===(e=this.getDiscordUserData())||void 0===e?void 0:e.avatar;return Ne(t,i)}loadImage(e){return new Promise(((i,s)=>t(this,void 0,void 0,(function*(){const t=yield fetch(e);if(!t.ok)return void s(new Error(`${t.status} ${t.statusText}`));const n=yield t.blob(),o=new FileReader;o.onerror=s,o.onload=()=>{i(o.result)},o.readAsDataURL(n)}))))}getDiscordUserData(){var e;return null===(e=window.discordSDK)||void 0===e?void 0:e._FRVRPatched_user}}var ke,Me,_e,xe;!function(e){e[e.shareMessage=0]="shareMessage",e[e.sendUpdate=1]="sendUpdate",e[e.invite=2]="invite",e[e.getFriends=3]="getFriends",e[e.getContextId=4]="getContextId",e[e.getContextData=5]="getContextData",e[e.getContextPlayers=6]="getContextPlayers"}(ke||(ke={})),function(e){e.UPDATE_STATUS="UPDATE_STATUS",e.SEND_GAME_INVITE="SEND_GAME_INVITE"}(Me||(Me={})),function(e){e.onFriendStatusUpdated="FRIEND_STATUS_UPDATED",e.onConnect="ON_CONNECT",e.onGameInvite="RECEIVE_GAME_INVITE",e.onError="ON_ERROR"}(_e||(_e={})),function(e){e.open="open",e.close="close",e.error="error",e.message="message",e.retry="retry"}(xe||(xe={}));function Fe(e,t,i){let s=0;for(let n=0;n<i;n++){const i=e[t+n];if(void 0===i)break;s+=i*Math.pow(16,n)}return s}function je(e){const t=function(e){const t=[];for(let i=0;i<e.length;i++){let s=Number(e[i]);for(let e=0;s||e<t.length;e++)s+=10*(t[e]||0),t[e]=s%16,s=(s-t[e])/16}return t}(e),i=Array(4);for(let e=0;e<4;e++)i[3-e]=Fe(t,4*e,4);return i}class Be{constructor(e,t){this.parts=e,this.str=t}static fromString(e){return new Be(je(e),e)}static fromBit(e){const t=Array(4),i=Math.floor(e/16);for(let s=0;s<4;s++)t[3-s]=s===i?1<<e-16*i:0;return new Be(t)}and({parts:e}){return new Be(this.parts.map(((t,i)=>t&e[i])))}or({parts:e}){return new Be(this.parts.map(((t,i)=>t|e[i])))}xor({parts:e}){return new Be(this.parts.map(((t,i)=>t^e[i])))}not(){return new Be(this.parts.map((e=>~e)))}equals({parts:e}){return this.parts.every(((t,i)=>t===e[i]))}}const Ve=function(){try{return BigInt,!0}catch(e){return!1}}(),$e={},ze=Ve?function(e){return BigInt(e)}:function(e){return e instanceof Be?e:("number"==typeof e&&(e=e.toString()),null!=$e[e]||($e[e]=Be.fromString(e)),$e[e])},He=ze(0),Ke=Ve?function(e=He,t=He){return e&t}:function(e=He,t=He){return e.and(t)},Ge=Ve?function(e,t){return e===t}:function(e,t){return null==e||null==t?e==t:e.equals(t)};const We={has:function(e,t){return Ge(Ke(e,t),t)},deserialize:ze,getFlag:Ve?function(e){return BigInt(1)<<BigInt(e)}:function(e){return Be.fromBit(e)}},qe=Object.freeze({CREATE_INSTANT_INVITE:We.getFlag(0)});const Ye={can:function(e,t){return We.has(We.deserialize(t),e)}},Xe=4002;class Je{constructor(e){this.logger=e}shareMessage(e){return null}sendUpdate(e){return t(this,void 0,void 0,(function*(){return null}))}canInvite(){return t(this,void 0,void 0,(function*(){const{permissions:e}=yield window.discordSDK.commands.getChannelPermissions();return Ye.can(qe.CREATE_INSTANT_INVITE,e)}))}invite(){var e;return t(this,void 0,void 0,(function*(){if(this.canInvite())try{yield window.discordSDK.commands.openInviteDialog()}catch(t){null===(e=this.logger)||void 0===e||e.error("Unable to open invite dialog",t)}}))}getContextId(){return t(this,void 0,void 0,(function*(){return window.discordSDK.channelId}))}getContextData(){var e;return t(this,void 0,void 0,(function*(){const t=window.discordSDK.channelId;if(t)try{return yield window.discordSDK.commands.getChannel({channel_id:t})}catch(i){if(i.code===Xe&&window.discordSDK.commands.getSelectedVoiceChannel)try{return yield window.discordSDK.commands.getSelectedVoiceChannel()}catch(i){null===(e=this.logger)||void 0===e||e.error("[Discord] getContextData legacy Error:",i);return{guild_id:window.discordSDK.guildId,id:t,name:""}}return}}))}getChannelParticipantsWrapper(){var e;return t(this,void 0,void 0,(function*(){try{return yield window.discordSDK.commands.getInstanceConnectedParticipants()}catch(t){const i={participants:[]};if(t.code===Xe&&window.discordSDK.commands.getSelectedVoiceChannel)try{return window.discordSDK.commands.getSelectedVoiceChannel().then((function(e){if(e.voice_states)for(let t=0;t<e.voice_states.length;t++){const s=e.voice_states[t].user;s&&i.participants.push({id:s.id,username:s.username,discriminator:s.discriminator,avatar:s.avatar,nickname:e.voice_states[t].nick})}return i}))}catch(t){return null===(e=this.logger)||void 0===e||e.error("[Discord] getChannelParticipantsWrapper legacy Error:",t),i}return i}}))}getContextPlayers(){return t(this,void 0,void 0,(function*(){const{participants:e}=yield this.getChannelParticipantsWrapper();return(null==e?void 0:e.map((e=>({id:e.id,name:e.username,image:Ne(e.id,e.avatar),channel:Se,nickname:e.nickname}))))||[]}))}getFriends(){return t(this,void 0,void 0,(function*(){return this.getChannelParticipantsWrapper().then((({participants:e})=>null==e?void 0:e.filter((e=>{var t;const i=null===(t=window.discordSDK)||void 0===t?void 0:t._FRVRPatched_user;if(e.id!==(null==i?void 0:i.id))return e})).map((e=>({id:e.id,name:e.username,image:Ne(e.id,e.avatar),channel:Se,nickname:e.nickname})))))}))}getSupportedAPIs(){return[ke.getContextId,ke.getContextData,ke.getContextPlayers,ke.getFriends,ke.invite]}}const Ze=/\{([a-z]+)\}/g;function Qe({originalURL:e,prefix:t,prefixHost:i,target:s}){const n=new URL(`https://${s}`),o=function(e){const t=e.replaceAll(".","\\.").replaceAll("%7B","{").replaceAll("%7D","}").replace(Ze,((e,t)=>`(?<${t}>[\\w-]+)`));return new RegExp(`${t}(/|$)`)}(n.host),r=e.toString().match(o);if(null==r)return null;const d=new URL(e.toString());return d.host=i,d.pathname=t.replace(Ze,((e,t)=>{var i;return null===(i=null==r?void 0:r.groups)||void 0===i?void 0:i[t]})),d.pathname+="/"===d.pathname?e.pathname.slice(1):e.pathname,d.pathname=d.pathname.replace(n.pathname,""),d}function et(e,t=window.location.protocol,i=window.location.host){return e.startsWith("/")?new URL(`${t}//${i}${e}`):function(e){try{return Boolean(new URL(e))}catch(e){return!1}}(e)?new URL(e):new URL(`${t}//${i}/${e}`)}function tt({url:e,mappings:t}){for(const i of t){const t=Qe({originalURL:e,prefix:i.prefix,target:i.target,prefixHost:window.location.host});if(t)return t}return e}function it(e){!function(e){for(const t of e){const e=t.prefix.match(/\{.*?\}/g)||[],i=t.target.match(/\{.*?\}/g)||[];if(e.length!=i.length)throw new Error(`Non matching substituition tokens in: '${t.prefix}', '${t.target}'`);for(const s of e){if(!s.match(/^\{[a-z]+\}$/))throw new Error(`Invalid substituition token: '${s}' in: '${t.prefix}'. Use only the format {a-z}`);if(i.indexOf(s)<0)throw new Error(`Non matching substituition tokens in: '${t.prefix}', '${t.target}'`)}}}(e),e=function(e){return e.sort(((e,t)=>{const i=new URL(`https://${e.target}`).host.split(".");return new URL(`https://${t.target}`).host.split(".").length-i.length}))}(e||[]);const t=window.fetch;window.fetch=function(i,s){const n=tt({url:et((null==i?void 0:i.url)||i.toString()),mappings:e});return t(n.toString(),s)};const i=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(t,s,n,o,r){const d=tt({url:et(s),mappings:e});i.apply(this,[t,d.toString(),n,o,r])};class s extends WebSocket{constructor(t,i){super(tt({url:et(t instanceof URL?t.toString():t,"wss:"),mappings:e}).toString(),i)}}window.WebSocket=s,window.getScriptSrc=window.getScriptSrc||{},window.getScriptSrc=t=>tt({url:et(t instanceof URL?t.toString():t,"wss:"),mappings:e}).toString();const n=Element.prototype.appendChild;Element.prototype.appendChild=function(t){if("SCRIPT"===t.tagName&&t.getAttribute){const i=t.getAttribute("src");if(i&&!i.includes("discord_activity_sdk")){const s=tt({url:et(i,"wss:"),mappings:e});t.setAttribute("src",s.toString())}}return n.call(this,t)}}var st,nt=[{prefix:"/discord",target:"discord.com"},{prefix:"/storagegoogleapis",target:"storage.googleapis.com"},{prefix:"/google-analytics",target:"google-analytics.com"},{prefix:"/coeus-frvr",target:"coeus.frvr.com"},{prefix:"/stagingcrucible-frvr",target:"staging.crucible.frvr.com"},{prefix:"/crucible-frvr",target:"crucible.frvr.com"},{prefix:"/fran-cdn-frvr",target:"fran-cdn.frvr.com"},{prefix:"/cdnfrvr",target:"cdn.frvr.com"},{prefix:"/frvr",target:"frvr.com"}];!function(e){e[e.getRoomData=0]="getRoomData",e[e.isInRoom=1]="isInRoom",e[e.getRoomId=2]="getRoomId",e[e.getPlayers=3]="getPlayers",e[e.subscribeToPlayerJoined=4]="subscribeToPlayerJoined",e[e.subscribeToPlayerLeft=5]="subscribeToPlayerLeft"}(st||(st={}));class ot{getId(){return Se}isInRoom(){return t(this,void 0,void 0,(function*(){return!0}))}getRoomId(){return t(this,void 0,void 0,(function*(){return(yield window.discordSDK.commands.getSelectedVoiceChannel()).id}))}getRoomData(){return t(this,void 0,void 0,(function*(){return yield window.discordSDK.commands.getSelectedVoiceChannel()}))}getPlayers(){var e;return t(this,void 0,void 0,(function*(){const t=yield window.discordSDK.commands.getSelectedVoiceChannel();return(null===(e=null==t?void 0:t.voice_states)||void 0===e?void 0:e.map((e=>({id:e.user.id,name:e.user.username,image:Ne(e.user.id,e.user.avatar),channel:Se,nickname:e.nick}))))||[]}))}getSupportedAPIs(){return[st.isInRoom,st.getRoomId,st.getRoomData,st.getPlayers]}isSupportedAPI(e){return this.getSupportedAPIs().includes(e)}}class rt{constructor(){}canNavigate(){return!0}navigate(e){return t(this,void 0,void 0,(function*(){yield window.discordSDK.commands.openExternalLink({url:e})}))}canOpenChannelAppStore(){return!1}openChannelAppStore(){return t(this,void 0,void 0,(function*(){}))}}class dt extends ie{constructor(){super(...arguments),this.characteristics=Object.assign(Object.assign({},e.defaultCharacteristics),{allowExternalLinks:!1,allowInternalLinks:!1,allowNavigation:!1,allowSendBeacon:!1})}init(){var e,i,s,n;return t(this,void 0,void 0,(function*(){for(null===(e=this.logger)||void 0===e||e.log("[Discord-sub-channel] init network shims"),this.disableNetworkShims||it(this.URLMappings),yield re(this.discordSDKPath,"discordSdkScript");!window.DiscordSDK;)null===(i=this.logger)||void 0===i||i.log("[Discord-sub-channel] waiting for discord sdk to load"),yield new Promise((e=>setTimeout(e,100)));window.discordSDK||(window.discordSDK=new window.DiscordSDK(this.discordAppID));const t=setTimeout((()=>{var e;null===(e=this.logger)||void 0===e||e.error("[Discord-sub-channel] discordSDK ready timeout. Likely wrong or missing appId",this.discordAppID)}),1e4);if(yield window.discordSDK.ready(),this.encourageHardwareAcceleration){const e=yield window.discordSDK.commands.encourageHardwareAcceleration();null===(s=this.logger)||void 0===s||s.log("[Discord-sub-channel] Hardware Acceleration is "+(e.enabled?"enabled":"disabled"))}clearTimeout(t),null===(n=this.logger)||void 0===n||n.log("[Discord-sub-channel] discordSDK initialized")}))}getId(){return Se}setConfig({gameId:e,channels:t}){super.setConfig({gameId:e});const i=null==t?void 0:t.discord;this.discordSDKPath=(null==i?void 0:i.discordSDKPath)||"assets/discord.iframe.sdk.bundle_patched.js",this.discordAppID=null==i?void 0:i.appId,this.URLMappings=[...(null==i?void 0:i.URLMappings)||[],...nt],this.disableNetworkShims=(null==i?void 0:i.disableNetworkShims)||!1,this.encourageHardwareAcceleration=null==i?void 0:i.encourageHardwareAcceleration}onModulesUpdated({logger:e}){this.logger=e}getBootstrapper(){return new Re(this.logger)}getConsentProvider(){return e.consentToAllConsentProvider}getIAPProvider(e){return new Ce(e,this.logger)}getShortcutProvider(){return e.emptyShortcutProvider}getProfile(){return new Oe}getSocialProvider(){return new Je(this.logger)}getLiveRoomProvider(){return new ot}getAuthProviders(e,t){return[new Ue(e,t,this.discordAppID,this.logger)]}getNavigationProvider(){return new rt}}const at={crazygames:{"==":[{var:"query.partnerid"},"8289067739"]},mspwa:{or:[{">=":[{var:"query.mspwa"},""]},{">=":[{var:"query.msstart_sdk_init"},""]}]},discord:{endsWith:["discordsays.com",{var:"location.host"}]}};function lt(e){const t=new URLSearchParams(window.location.search),i={query:Object.fromEntries(t.entries()),document:document,location:location},s=function e(t,i){var s,n;if("object"!=typeof t)return t;const o=Object.keys(t)[0],r=t[o];switch(o){case"and":return r.every((t=>e(t,i)));case"or":return r.some((t=>e(t,i)));case"<":return e(r[0],i)<e(r[1],i);case">":return e(r[0],i)>e(r[1],i);case"<=":return e(r[0],i)<=e(r[1],i);case">=":return e(r[0],i)>=e(r[1],i);case"==":return e(r[0],i)===e(r[1],i);case"!=":return e(r[0],i)!==e(r[1],i);case"var":return r.split(".").reduce(((e,t)=>e&&e[t]),i);case"in":return(null!==(s=e(r[1],i))&&void 0!==s?s:"").includes(e(r[0],i));case"endsWith":return(null!==(n=e(r[1],i))&&void 0!==n?n:"").endsWith(e(r[0],i));default:throw new Error(`Unknown operator: ${o}`)}}(e,i);return!!s}const ct=[{isDetected:e=>lt(e.crazygames),build:()=>new le},{isDetected:e=>lt(e.mspwa),build:()=>new Ae},{isDetected:e=>lt(e.discord),build:()=>new dt}];var ht,ut;if(window.FRVR){const e=null===(ut=null===(ht=window.FRVR.config)||void 0===ht?void 0:ht.channels)||void 0===ut?void 0:ut.web;window.FRVR.setChannel(function(e){null!=e||(e=at);const t=ct.find((t=>t.isDetected(e)));return t?t.build():new ie}(null==e?void 0:e.subchannelsDetection))}}(FRVRSDK),FRVRSDK.version=FRVRSDK.version||{},FRVRSDK.version.channel=FRVRSDK.version.channel||{},FRVRSDK.version.channel.v="10.31.0",FRVRSDK.version.channel.bts="1718368578050",FRVRSDK.version.channel.name="web";